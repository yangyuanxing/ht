/*
 * client3d.js - v0.3.1
 * Compiled Tue Sep 24 2019 17:40:31 GMT+0800 (GMT+08:00)
 * Copyright (c) 2019 www.hisense.com & www.hightopo.com
 */

var hteditor3d=function(){"use strict";function w(w){return/^scenes/.test(w)}function f(w){return/^models/.test(w)}function P(w){return/^symbols/.test(w)}function S(w){return/^assets/.test(w)}function m(w){return/\.obj$/i.test(w)}function D(w){return/\.mtl$/i.test(w)}function Q(w){return/\.(png|jpg|gif|jpeg|bmp|svg)$/i.test(w)}function B(w){return ht.Default.getImageMap()[w]?(delete ht.Default.getImageMap()[w],!0):ht.Default.getCompTypeMap()[w]?(delete ht.Default.getCompTypeMap()[w],!0):(void 0!==ht.Default.getShape3dModel(w)&&ht.Default.setShape3dModel(w,void 0),!1)}function C(w,f,P,S){var m=new ht.Tab;return m.setName(f),m.setView(P),w.getTabModel().add(m),S&&w.getTabModel().sm().ss(m),m}function p(w){var f=new RegExp("(^|&)"+w+"=([^&]*)(&|$)"),P=window.location.search.substr(1).match(f);return null!=P?decodeURIComponent(P[2]):null}var d={createTablePane:function(){var w=new ht.widget.TablePane;return w.getView().style.border=hteditor.config.color_line+" solid 1px",w},removeItem:function(w,f){if(w){var P=w.indexOf(f);P>=0&&w.splice(P,1)}},alert:function(w,f,P,S){var m=[{label:hteditor.getString("editor.ok"),action:function(){D.hide(),P&&P()}}],D=new ht.widget.Dialog({title:w||" ",contentPadding:20,width:S||300,draggable:!0,content:"<p>"+f+"</p>",buttons:m});D.show()},config:window.hteditor_config||{}},E=function(){};ht.Default.setImage("editor.axis",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(138,138,138)",borderCap:"round",shadowColor:"#1ABC9C",points:[8,2.48536,8,9,1.08734,12.01256,8,9,14,13]}]}),ht.Default.setImage("hxeditor.cube",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[2.48996,3.51341,9.97783,10.97318]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15,1,12.39369,3.59417,12.39369,14.44,15,11.41017,15,1,5.46231,1,2.50972,3.59417]}]}),ht.Default.setImage("hxeditor.cube.image",{width:100,height:100,comps:[{type:"rect",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("hxeditor.sphere",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.49999,1.5,13,13]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",arcFrom:3.22886,arcTo:5.96903,arcClose:!1,arcOval:!0,opacity:.4,rotation:2.4578,rect:[.10993,1.43114,12.94079,10.68594]}]}),ht.Default.setImage("hxeditor.sphere.image",{width:100,height:100,comps:[{type:"oval",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("hxeditor.cylinder",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5,1.5,13,9.5]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",arcClose:!1,arcOval:!0,opacity:.4,rotation:3.14159,rect:[1.49362,6,13,9.5]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[1.49362,10.75,1.48724,6.35177]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[14.5,10.75,14.5,6.10177]}]}),ht.Default.setImage("hxeditor.floor",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5056,9.71598,12.98879,3.75]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",opacity:.2,points:[14.49439,9.71598,14.49439,1.61266,4.70858,1.61266,4.70858,9.71598]}]}),ht.Default.setImage("hxeditor.wall",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.2,points:[2,15,10,15,14,11]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[6,2,14,2,14,11,6,11,2,15,2,6,6,2,6,11]}]}),ht.Default.setImage("hxeditor.cancel",{background:"red",width:16,height:16,comps:[{type:"circle",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[1,1,14,14]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[10.94702,4.96729,4.99893,11.04194]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[5,4.96729,11.29505,11.29505]}]}),ht.Default.setImage("hxeditor.pipeline",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[14.11524,6.61831,14.11524,6.61831,9.30492,12.81031,8.07676,10.14929,6.8486,7.48826,9.56079,4.00846,6.33686,4.00846,3.11293,4.00846,.86129,8.92112,.86129,8.92112],segments:[1,4,4,4]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15.28357,7.93382,15.28357,7.93382,10.47326,14.12582,9.24509,11.46479,8.01693,8.80377,10.72913,5.32397,7.50519,5.32397,4.28126,5.32397,2.02963,10.23663,2.02963,10.23663],segments:[1,4,4,4]}]}),ht.Default.setImage("editor.doorWindow",{width:16,height:16,comps:[{type:"rect",borderWidth:1,borderColor:"#979797",rect:[4.5,.5,7,15]},{type:"shape",borderWidth:1,borderColor:"#979797",points:[8.5469,8,10.42756,8]}]});var I=(function(){function w(w){this.value=w}function f(f){function P(w,f){return new Promise(function(P,m){var B={key:w,arg:f,resolve:P,reject:m,next:null};Q?Q=Q.next=B:(D=Q=B,S(w,f))})}function S(P,D){try{var Q=f[P](D),B=Q.value;B instanceof w?Promise.resolve(B.value).then(function(w){S("next",w)},function(w){S("throw",w)}):m(Q.done?"return":"normal",Q.value)}catch(w){m("throw",w)}}function m(w,f){switch(w){case"return":D.resolve({value:f,done:!0});break;case"throw":D.reject(f);break;default:D.resolve({value:f,done:!1})}D=D.next,D?S(D.key,D.arg):Q=null}var D,Q;this._invoke=P,"function"!=typeof f.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(f.prototype[Symbol.asyncIterator]=function(){return this}),f.prototype.next=function(w){return this._invoke("next",w)},f.prototype.throw=function(w){return this._invoke("throw",w)},f.prototype.return=function(w){return this._invoke("return",w)}}(),function(w,f){if(!(w instanceof f))throw new TypeError("Cannot call a class as a function")}),c=function(){function w(w,f){for(var P=0;P<f.length;P++){var S=f[P];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(w,S.key,S)}}return function(f,P,S){return P&&w(f.prototype,P),S&&w(f,S),f}}(),a=function(w,f){if("function"!=typeof f&&null!==f)throw new TypeError("Super expression must either be null or a function, not "+typeof f);w.prototype=Object.create(f&&f.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(w,f):w.__proto__=f)},o=function(w,f){if(!w)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!f||"object"!=typeof f&&"function"!=typeof f?w:f},s=function(){function w(f,P){var S=this;I(this,w),this.handler=f,this.editor=P,this.cookie=0,this.callbacks={},this.cmds={};var m=hteditor.config.host||window.location.hostname,D=hteditor.config.port||window.location.port,Q="http://"+m+":"+D;this.socket=io.connect(Q),this.socket.on("connect",function(){S.handler({type:"connected",message:Q})}),this.socket.on("disconnect",function(){S.handler({type:"disconnected",message:Q})}),this.socket.on("fileChanged",function(w){S.handler({type:"fileChanged",path:w.path,event:w.event})}),this.socket.on("operationDone",function(w,f){S.handleRespone(w,f)}),this.socket.on("download",function(w){S.handler({type:"download",path:w})}),this.socket.on("confirm",function(w,f){S.handler({type:"confirm",path:w,datas:f})})}return w.prototype.request=function(w,f,P){var S=++this.cookie;this.callbacks[S]=P,this.cmds[S]=w;var m=this.editor.sid;this.socket.emit(w,S,f,m?{sid:m}:null);var D=w;f&&(ht.Default.isString(f)?D=w+": "+f:f.path&&(D=w+": "+f.path)),this.handler({type:"request",message:D,cmd:w,data:f})},w.prototype.handleRespone=function(w,f){var P=this.callbacks[w],S=this.cmds[w];delete this.callbacks[w],delete this.cmds[w],P&&P(f),this.handler({type:"response",message:S,cmd:S,data:f})},w}(),e=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"scenes"))}return a(f,w),f.prototype.initTreeMenu=function(w,f){this.addLocateTreeFileItem(f),this.addNewFolderItem(f,this.tree),this.addRenameItem(f,this.tree),this.addDeleteItem(f,this.tree)},f.prototype.initListMenu=function(w,f){this.addLocateListFileItem(f),this.addNewFolderItem(f,this.list),this.addCopyItem(f),this.addPasteItem(f),this.addRenameItem(f,this.list),this.addDeleteItem(f,this.list),this.addExportItem(f)},f}(hteditor.Explorer),T=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"models"))}return a(f,w),f.prototype.initTreeMenu=function(w,f){this.addLocateTreeFileItem(f),this.addNewFolderItem(f,this.tree),this.addRenameItem(f,this.tree),this.addDeleteItem(f,this.tree)},f.prototype.initListMenu=function(w,f){this.addLocateListFileItem(f),this.addNewFolderItem(f,this.list),this.addCopyItem(f),this.addPasteItem(f),this.addRenameItem(f,this.list),this.addDeleteItem(f,this.list)},f}(hteditor.Explorer),N=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"symbols"))}return a(f,w),f.prototype.initTreeMenu=function(w,f){this.addLocateTreeFileItem(f),this.addNewFolderItem(f,this.tree),this.addRenameItem(f,this.tree),this.addDeleteItem(f,this.tree)},f.prototype.initListMenu=function(w,f){this.addLocateListFileItem(f),this.addNewFolderItem(f,this.list),this.addCopyItem(f),this.addPasteItem(f),this.addRenameItem(f,this.list),this.addDeleteItem(f,this.list)},f}(hteditor.Explorer),x=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"assets"))}return a(f,w),f.prototype.initTreeMenu=function(w,f){this.addLocateTreeFileItem(f),this.addNewFolderItem(f,this.tree),this.addRenameItem(f,this.tree),this.addDeleteItem(f,this.tree)},f.prototype.initListMenu=function(w,f){this.addLocateListFileItem(f),this.addNewFolderItem(f,this.list),this.addCopyItem(f),this.addPasteItem(f),this.addRenameItem(f,this.list),this.addDeleteItem(f,this.list)},f}(hteditor.Explorer),W=hteditor.getString,$=function(w){function f(P){I(this,f);var S=o(this,w.call(this));S.editor=P,S.editor.menus.push(S);var m=[{label:W("editor.newsceneview"),action:function(){S.editor.newScene()}},{label:W("editor.newmodel"),items:[{label:W("editor.obj"),action:function(){S.editor.newOBJModel()}}]}];return S.setItems(m),S}return a(f,w),f}(ht.widget.ContextMenu),k=function(w){function f(P){I(this,f);var S=o(this,w.call(this,P.gv));return S.editor=P,S}return a(f,w),f.prototype.beginTransaction=function(){this._isBeginTransaction||(this._isBeginTransaction=!0,this.dm.beginTransaction())},f.prototype.endTransaction=function(){this._isBeginTransaction&&(this._isBeginTransaction=!1,this.dm.endTransaction())},f.prototype.getDataAt=function(w){return this.gv.getDataAt(w)},f.prototype.getNodeAt=function(w){var f=this.getDataAt(w);return f instanceof ht.Node?f:null},f.prototype.setUp=function(){w.prototype.setUp.call(this),this.sm.cs()},f.prototype.$0$=function(w){},f.prototype.drawRect=function(w,f,P,S){f=this.toRect(f),S&&(w.fillStyle=S),P&&(w.strokeStyle=P),w.lineWidth=1,w.beginPath(),w.rect(f.x,f.y,f.width,f.height),w.stroke(),S&&w.fill(),P&&w.stroke()},f.prototype.drawPoint=function(w,f,P,S,m){f=this.toPoint(f),m&&(w.fillStyle=m),S&&(w.strokeStyle=S),w.lineWidth=1,w.beginPath(),w.arc(f.x,f.y,P,0,2*Math.PI,!0),m&&w.fill(),S&&w.stroke()},f.prototype.drawPoints=function(w,f,P,S,m){for(var D=0;D<f.length;D++)this.drawPoint(w,f[D],P,S,m)},f.prototype.drawLine=function(w,f,P,S){f=this.toPoint(f),P=this.toPoint(P),w.lineWidth=1,w.strokeStyle=S,w.beginPath(),w.moveTo(f.x,f.y),w.lineTo(P.x,P.y),w.stroke()},f.prototype.toRect=function(w){var f=this.zoom;return{x:w.x*f+this.tx,y:w.y*f+this.ty,width:w.width*f,height:w.height*f}},f.prototype.toPoint=function(w){return{x:w.x*this.zoom+this.tx,y:w.y*this.zoom+this.ty}},f.prototype.addData=function(w){this.editor.dm.add(w),this.editor.sm.ss(w),this.editor.gv.setFocus()},f.prototype.remove=function(w){this.dm.remove(w)},f.prototype.lp=function(w){return this.gv.lp(w)},c(f,[{key:"dm",get:function(){return this.gv.dm()}},{key:"sm",get:function(){return this.gv.dm().sm()}},{key:"zoom",get:function(){return this.gv.getZoom()}},{key:"tx",get:function(){return this.gv.tx()}},{key:"ty",get:function(){return this.gv.ty()}}]),f}(ht.graph.Interactor),u=function(w){function f(P,S,m){I(this,f);var D=o(this,w.call(this,P));return D.createFunc=S,D.points=[],D.segments=[],D.nextPoint=null,D.fill=m,D}return a(f,w),f.prototype.tearDown=function(){w.prototype.tearDown.call(this),this.points=[],this.segments=[],this.nextPoint=null},f.prototype.$49$=function(w){this.nextPoint?(this.nextPoint=null,this.editor.rulerView.validateCanvas()):this.createShape()},f.prototype.createShape=function(){if(this.points.length>1){var w=this.createFunc(this.points,this.segments);this.addData(w)}this.editor.$5$("edit"),this.editor.pointsEditingMode=!0},f.prototype.handle_mousedown=function(w){this.handle_touchstart(w)},f.prototype.handle_touchstart=function(w){if(ht.Default.preventDefault(w),ht.Default.isLeftButton(w))if(this.gv.setFocus(w),ht.Default.isDoubleClick(w))this.createShape();else{var f=this.lp(w);if(this.points.length){var P=this.points[this.points.length-1];if(Math.abs(P.x-f.x)<.01&&Math.abs(P.y-f.y)<.01)return}this.points.push(f),this.segments.push(this.nextPoint?2:1),this.nextPoint=this.lp(w),this.editor.rulerView.validateCanvas()}},f.prototype.handle_mousemove=function(w){this.nextPoint&&(this.nextPoint=this.lp(w),this.editor.rulerView.validateCanvas())},f.prototype.$0$=function(w){w.beginPath();for(var f=0,P=void 0,S=void 0,m=void 0,D=0;D<this.segments.length;D++){var Q=this.segments[D];1===Q?(P=this.toPoint(this.points[f++]),w.moveTo(P.x,P.y)):2===Q?(P=this.toPoint(this.points[f++]),w.lineTo(P.x,P.y)):3===Q?(P=this.toPoint(this.points[f++]),S=this.toPoint(this.points[f++]),w.quadraticCurveTo(P.x,P.y,S.x,S.y)):4===Q?(P=this.toPoint(this.points[f++]),S=this.toPoint(this.points[f++]),m=this.toPoint(this.points[f++]),w.bezierCurveTo(P.x,po,y,S.x,S.y,m.x,m.y)):5===Q&&w.closePath()}if(this.nextPoint){var B=this.toPoint(this.nextPoint);w.lineTo(B.x,B.y)}w.strokeStyle=hteditor.config.color_data_border,w.lineWidth=1,w.stroke(),this.fill&&(w.fillStyle=hteditor.config.color_transparent,w.fill()),this.drawPoints(w,this.points,4,hteditor.config.color_data_border,hteditor.config.color_data_background)},f}(k),_=function(w){function f(P,S){I(this,f);var m=o(this,w.call(this,P));return m.createFunc=S,m}return a(f,w),f.prototype.tearDown=function(){w.prototype.tearDown.call(this),this.node=this.p1=this.p2=null},f.prototype.handle_mousedown=function(w){this.handle_touchstart(w)},f.prototype.handle_touchstart=function(w){ht.Default.preventDefault(w),ht.Default.isLeftButton(w)&&(this.gv.setFocus(w),this.p1=this.lp(w),this.startDragging(w))},f.prototype.handleWindowMouseMove=function(w){this.handleWindowTouchMove(w)},f.prototype.handleWindowMouseUp=function(w){this.handleWindowTouchEnd(w)},f.prototype.handleWindowTouchMove=function(w){if(ht.Default.preventDefault(w),this.p1){this.p2=this.lp(w);var f=ht.Default.unionPoint(this.p1,this.p2);if(this.node)this.node.setRect(f);else{if(!f.width||!f.height)return;this.beginTransaction(),this.createNode(f,!1)}}},f.prototype.handleWindowTouchEnd=function(w){ht.Default.preventDefault(w),this.endTransaction(),!this.node&&this.p1&&this.createNode({x:this.p1.x-25,y:this.p1.y-25,width:50,height:50},!0),hteditor.config.continuousCreating?this.node=this.p1=this.p2=null:this.editor.$5$("edit")},f.prototype.createNode=function(w,f){this.node=this.createFunc(w,f),this.node.s3(50,50,50),f?this.node.setPosition(w.x+w.width/2,w.y+w.height/2):this.node.setRect(w),this.addData(this.node)},f.prototype.$0$=function(w){this.node&&this.drawRect(w,this.node.getRect(),hteditor.config.color_data_border)},f}(k),V=hteditor.getString,l=function(w){function f(P){I(this,f);var S=o(this,w.call(this));return S.editor=P,S.initMenu(),S.$69$(),S.enableToolTip(),S}return a(f,w),f.prototype.initMenu=function(){var w=this.editor.mainMenu=new $(this.editor),f=function(f){w.isShowing()&&!w.getView().contains(f.target)&&w.hide()};window.addEventListener("touchstart",f,!1),window.addEventListener("mousedown",f,!1)},f.prototype.$69$=function(){var w=[];w.push(this.$68$()),w.push(this.createEditItem()),w.push(this.createCubeItem()),w.push(this.createCylinderItem()),w.push(this.createSphereItem()),w.push(this.createWallItem()),w.push(this.createDoorWindowItem()),w.push(this.createFloorItem()),w.push(this.createPipelineItem()),this.setItems(w)},f.prototype.$68$=function(){var w=this,f=hteditor.createItem("menu",V("editor.menu"),"editor.menu");return f.action=function(f,P,S){w.editor.mainMenu.isShowing()||(w.editor.mainMenu.showOnView(w,4,20),S.preventDefault(),S.stopPropagation())},f},f.prototype.createEditItem=function(){var w=this,f=function(){return"edit"===w.editor.$4$()},P=hteditor.createItem("edit",V("editor.edit"),"editor.edit",f);return P.action=function(){w.editor.$5$("edit")},P},f.prototype.createWallItem=function(){var w=this,f=function(){return"wall"===w.editor.$4$()},P=hteditor.createItem("wall",V("editor.wall"),"hxeditor.wall",f);return P.action=function(){var f=new u(w.editor,function(w,f){var P=new ht.Shape;return P.setTall(280),P.setThickness(14),P.setElevation(P.getTall()/2),P.setPoints(w),P.setSegments(f),P.s({"all.color":"#DDDDDD","shape.background":null,"shape.border.width":P.getThickness(),"shape.border.color":"#DDDDDD"}),P});w.editor.$5$("wall",f)},P},f.prototype.createDoorWindowItem=function(){var w=this,f=function(){return"doowWindow"===w.editor.$4$()},P=hteditor.createItem("doorWindow",V("editor.doorwindow"),"editor.doorWindow",f);return P.action=function(){var f=new _(w.editor,function(){return new ht.DoorWindow},!0);w.editor.$5$("doowWindow",f)},P},f.prototype.createFloorItem=function(){var w=this,f=function(){return"floor"===w.editor.$4$()},P=hteditor.createItem("floor",V("editor.floor"),"hxeditor.floor",f);return P.action=function(){var f=new u(w.editor,function(w,f){var P=new ht.Shape;return P.setTall(10),P.setThickness(-1),P.setElevation(-P.getTall()/2),P.setPoints(w),P.setSegments(f),P.s({"shape3d.color":"#EEEEEE","shape3d.top.color":"#EEEEEE","shape3d.bottom.color":"#EEEEEE","shape.background":"#EEEEEE"}),P.setAnchor3d(.5,0,.5),P},!0);w.editor.$5$("floor",f)},P},f.prototype.createPipelineItem=function(){var w=this,f=function(){return"pipeline"===w.editor.$4$()},P=hteditor.createItem("pipeline",V("editor.pipeline"),"hxeditor.pipeline",f);return P.action=function(){var f=new u(w.editor,function(w,f){var P=new ht.Polyline;return P.setPoints(w),P.setSegments(f),P.setThickness(10),P.s({shape3d:"cylinder","shape3d.color":"#BFBFBF","shape3d.top.color":"#BFBFBF","shape3d.bottom.color":"#BFBFBF","shape.background":null,"shape.border.width":P.getThickness(),"shape.border.color":"#BFBFBF"}),P});w.editor.$5$("pipeline",f)},P},f.prototype.createCubeItem=function(){var w=this,f=function(){return"cube"===w.editor.$4$()},P=hteditor.createItem("cube",V("editor.cube"),"hxeditor.cube",f);return P.action=function(){var f=new _(w.editor,function(){var w=new ht.Node;return w.s({"all.color":"#DDDDDD"}),w.setAnchor3d(.5,0,.5),w},!0);w.editor.$5$("cube",f)},P},f.prototype.createCylinderItem=function(){var w=this,f=function(){return"cylinder"===w.editor.$4$()},P=hteditor.createItem("cylinder",V("editor.cylinder"),"hxeditor.cylinder",f);return P.action=function(){var f=new _(w.editor,function(){var w=new ht.Node;return w.s({shape3d:"cylinder","shape3d.color":"#DDDDDD"}),w.setAnchor3d(.5,0,.5),w},!0);w.editor.$5$("cylinder",f)},P},f.prototype.createSphereItem=function(){var w=this,f=function(){return"sphere"===w.editor.$4$()},P=hteditor.createItem("cube",V("editor.sphere"),"hxeditor.sphere",f);return P.action=function(){var f=new _(w.editor,function(){var w=new ht.Node;return w.s({shape3d:"sphere","shape3d.color":"#DDDDDD"}),w.setAnchor3d(.5,0,.5),w},!0);w.editor.$5$("sphere",f)},P},f}(ht.widget.Toolbar),g=hteditor.getString,F=function(w){function f(P){I(this,f);var S=o(this,w.call(this));return S.editor=P,S.$69$(),S.enableToolTip(),S.setStickToRight(!0),S.editor.gv.addPropertyChangeListener(S.handlePropertyChange,S),S.$70$(),S}return a(f,w),f.prototype.handlePropertyChange=function(w){"zoom"===w.property&&this.$70$()},f.prototype.$70$=function(){this.label.innerHTML=parseInt(100*this.editor.gv.getZoom())+"%"},f.prototype.$69$=function(){var w=this,f=void 0,P=[];f=hteditor.createItem("save",g("editor.save"),"editor.save"),f.action=function(){w.editor.save()},P.push(f),f=hteditor.createItem("reload",g("editor.reload"),"editor.reload"),f.action=function(){w.editor.reload()},P.push(f),P.push({separator:!0}),f=hteditor.createItem("grid",g("editor.showaxis"),"editor.axis",function(){return!w.editor.scene.isEditHelperDisabled()}),f.action=function(){w.editor.scene.setEditHelperDisabled(!w.editor.scene.isEditHelperDisabled())},P.push(f),f=hteditor.createItem("grid",g("editor.showgrid"),"editor.grid",function(){return w.editor.gridVisible}),f.action=function(){w.editor.toggleGridEnabled()},P.push(f),f=hteditor.createItem("preview",g("editor.preview"),"editor.preview"),f.action=function(){w.editor.preview()},P.push(f),P.push({separator:!0}),P.push(this.createZoomItem()),f=hteditor.createItem("zoomToFit",g("editor.zoomtofit"),"editor.zoomtofit"),f.action=function(){w.editor.zoomToFit()},P.push(f),P.push({separator:!0}),f=hteditor.createItem("toggleLeft",g("editor.toggleleft"),"editor.toggleleft"),f.action=function(){w.editor.toggleLeft()},P.push(f),f=hteditor.createItem("toggleRight",g("editor.toggleright"),"editor.toggleright"),f.action=function(){w.editor.toggleRight()},P.push(f),this.setItems(P)},f.prototype.createZoomItem=function(){var w=this,f=this.label=ht.Default.createDiv(!0);f.style.font=this.getLabelFont(),f.style.color=this.getLabelColor(),f.style.cursor="ew-resize",f.style.width="40px",f.style.height=ht.Default.widgetRowHeight+"px",f.style.lineHeight=ht.Default.widgetRowHeight+"px",f.style.whiteSpace="nowrap",f.style.textAlign="center";var P=function(f){f.preventDefault();var P=w.editor.gv;ht.Default.isDoubleClick(f)&&P.zoomReset();var S=P.getZoom(),m=ht.Default.getClientPoint(f).x,D=function(w){w.preventDefault();var f=ht.Default.getClientPoint(w).x-m;P.setZoom(S*(1+.005*f))};window.addEventListener("mousemove",D,!1),window.addEventListener("touchmove",D,!1);var Q=function(w){w.preventDefault(),window.removeEventListener("mousemove",D,!1),window.removeEventListener("touchmove",D,!1),window.removeEventListener("mouseup",Q,!1),window.removeEventListener("touchend",Q,!1)};window.addEventListener("mouseup",Q,!1),window.addEventListener("touchend",Q,!1)};return f.addEventListener("mousedown",P,!1),f.addEventListener("touchstart",P,!1),{id:"zoom",unfocusable:!0,element:f}},f}(ht.widget.Toolbar),R=function(w){function f(P){I(this,f);var S=o(this,w.call(this,P.dm));return S.editor=P,S.setEditable(!0),S.topDiv=ht.Default.createDiv(),S}return a(f,w),f.prototype.isInteractive=function(){return!1},f.prototype.handleDelete=function(){this.removeSelection()},f.prototype.getBrightness=function(){return null},f.prototype.isDroppable=function(w,f){return f.view===this.editor.models.list||(f.view===this.editor.symbols.list||f.view===this.editor.assets.list)},f.prototype.$59$=function(w){if(this.dragImage){var f=hteditor.config.dragImageSize,P=ht.Default.getPagePoint(w);this.dragImage.style.left=P.x-f/2+"px",this.dragImage.style.top=P.y-f/2+"px"}},f.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},f.prototype.handleCrossDrag=function(w,f,P){var S=this,m=P.view,D=m.draggingData;if("enter"===f){if(this._view.insertBefore(this.topDiv,this._scrollBarDiv),ht.Default.layout(this.topDiv,0,0,this.getWidth(),this.getHeight()),this.topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&D&&("model"===D.fileType||"symbol"===D.fileType||"image"===D.fileType)&&ht.Default.getImage(D.getImage())!==ht.Default.getImage("editor.unknown")){var Q=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(D.getImage(),Q,Q,"centerUniform",D,P.view,null,ht.Default.devicePixelRatio),this.$59$(w),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else if("exit"===f||"cancel"===f)ht.Default.removeHTML(this.topDiv),this.removeDragImage();else if("over"===f)this.$59$(w);else if("drop"===f&&(ht.Default.removeHTML(this.topDiv),D)){this.removeDragImage();var B=this.getHitPosition(w);m.isSelected(D)?m.sm().toSelection().each(function(f){m.handleDropToEditView?m.handleDropToEditView(S,f,B,w):S.$100$(f,B)}):m.handleDropToEditView?m.handleDropToEditView(this,D,B,w):this.$100$(D,B)}},f.prototype.$100$=function(w,f){if(w){var P=w.url,S=w.fileType;if("model"===S||"symbol"===S||Q(P)){var m=new ht.Node;"model"===S?m.s({shape3d:P}):("symbol"===S||Q(P))&&(m.s({shape3d:"billboard","shape3d.image":P,"shape3d.image.cache":!1,"shape3d.autorotate":!0,"shape3d.alwaysOnTop":!1,"shape3d.fixSizeOnScreen":[-1,-1]}),m.setImage(P)),m.setAnchor3d(.5,0,.5),m.p3(f),m.s("wf.visible","selected"),this.dm().add(m),this.sm().ss(m)}}},f.prototype.toImage=function(w){var f=d.config.imageSize||400,P=this.getWidth(),S=this.getHeight(),m=Math.max(P,S),D=f/m;return P=Math.floor(P*D),S=Math.floor(S*D),this.toCanvas(w,P,S).toDataURL("image/png",1)},f}(ht.graph3d.Graph3dView),i={width:!0,height:!0,position:!0,rotation:!0,anchor:!0,scale:!0,expanded:!0},h=function(){function w(f){var P=this;I(this,w),this.graphView=f,this._rulerEnabled=!0,this._view=ht.Default.createView(!0,this),this.graphView.addViewListener(function(w){"validate"===w.kind&&P.validateCanvas()}),this._hRuler=ht.Default.createCanvas(),this._vRuler=ht.Default.createCanvas(),this._view.appendChild(this._hRuler),this._view.appendChild(this._vRuler),this._view.appendChild(this.graphView.getView()),this.graphView.addPropertyChangeListener(function(){P.iv()}),this.dm.sm().addSelectionChangeListener(function(w){P.iv()}),this.dm.addDataPropertyChangeListener(function(w){P.handleDataPropertyChanged(w)}),this.dm.addPropertyChangeListener(function(w){P.handleDataModelPropertyChanged(w)}),this.dm.layout=function(w){P._autoLayout||(P._autoLayout=new ht.layout.AutoLayout(P.graphView)),P._autoLayout.layout(w,function(){P.graphView.fitContent(!0)})},this.graphView.setEditable(!0),this.graphView.getInteractors().each(function(w){w.keep=!0})}return w.prototype.handleDataPropertyChanged=function(w){i[w.property]&&this.iv()},w.prototype.handleDataModelPropertyChanged=function(w){this.validateCanvas()},w.prototype.onPropertyChanged=function(w){this.iv()},w.prototype.addData=function(w){this.dm.add(w),this.dm.sm().ss(w),this.graphView.setFocus()},w.prototype.validateCanvas=function(){var w=this.graphView._topCanvas;if(w){var f=hteditor.initContext(w);f.clearRect(0,0,w.clientWidth,w.clientHeight),this.graphView.getInteractors().each(function(w){w.$0$&&w.$0$(f)}),f.restore()}},w.prototype.redraw=function(){hteditor.EditView.prototype.redraw.apply(this,arguments)},w.prototype.validateImpl=function(){hteditor.EditView.prototype.validateImpl.apply(this,arguments)},w.prototype.drawVerticalText=function(){hteditor.EditView.prototype.drawVerticalText.apply(this,arguments)},w.prototype.drawRuler=function(){hteditor.EditView.prototype.drawRuler.apply(this,arguments)},c(w,[{key:"dm",get:function(){return this.graphView.dm()}}]),w}();hteditor.msClass(h,{ms_v:1,ms_fire:1,ms_ac:["rulerBackground","rulerFont","rulerColor","rulerSize","guideColor"],_rulerFont:hteditor.config.smallFont,_rulerBackground:hteditor.config.color_pane,_rulerColor:hteditor.config.color_dark,_rulerSize:hteditor.config.rulerSize,_guideColor:hteditor.config.color_transparent,_interactionState:void 0});var q=function(w){function f(P){I(this,f);var S=o(this,w.call(this,P.dm));return S.editor=P,S._topCanvas=ht.Default.createCanvas(),S._topDiv=ht.Default.createDiv(),S._view.insertBefore(S._topCanvas,S._scrollBarDiv),S._view.insertBefore(S._topDiv,S._scrollBarDiv),S.mi(function(w){"prepareMove"!==w.kind&&"prepareEdit"!==w.kind||!w.event.altKey||(S.editor.copy(),S.editor.paste(!0),S.validate())}),S}return a(f,w),f.prototype.isInteractive=function(){return!1},f.prototype.initMenu=function(){var w=this,f=[];this.menu=new ht.widget.ContextMenu(f),f.push({id:"bringToFront",label:hteditor.getString("editor.bringtofront"),action:function(){w.editor.bringToFront()},visible:function(){return!!w.editor.ld}}),f.push({id:"bringForward",label:hteditor.getString("editor.bringforward"),action:function(){w.editor.bringForward()},visible:function(){return!!w.editor.ld}}),f.push({id:"sendBackward",label:hteditor.getString("editor.sendbackward"),action:function(){w.editor.sendBackward()},visible:function(){return!!w.editor.ld}}),f.push({id:"sendToBack",label:hteditor.getString("editor.sendtoback"),action:function(){w.editor.sendToBack()},visible:function(){return!!w.editor.ld}}),f.push({separator:!0,visible:function(){return!!w.editor.ld}}),this.menu.addTo(this.getView()),this.editor.menus.push(this.menu)},f.prototype.getUnionNodeRect=function(w){var f=this,P=void 0;return w=w._as||w,w.forEach(function(w){w instanceof ht.Node&&(P=ht.Default.unionRect(P,f.getNodeRect(w)))}),P},f.prototype.getImage=function(w){var f=w.s("shape3d");if(f){var P=ht.Default.getShape3dModel(f);if(P&&P.json&&P.json.image)return P.json.image;if("sphere"===f||"cylinder"===f)return"hxeditor.sphere.image"}var S=w.getImage();return S&&"node_image"!==S?S:w.s("shape3d.image")?w.s("shape3d.image"):"hxeditor.cube.image"},f.prototype.getSelectWidth=function(w){return!this.isEditable(w)||w instanceof ht.Edge?w.s("select.width"):0},f.prototype.isDroppable=function(w,f){return f.view===this.editor.models.list||(f.view===this.editor.symbols.list||f.view===this.editor.assets.list)},f.prototype.$59$=function(w){if(this.dragImage){var f=hteditor.config.dragImageSize,P=ht.Default.getPagePoint(w);this.dragImage.style.left=P.x-f/2+"px",this.dragImage.style.top=P.y-f/2+"px"}},f.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},f.prototype.handleCrossDrag=function(w,f,P){var S=this,m=P.view,D=m.draggingData;if("enter"===f){if(this._topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&D&&("model"===D.fileType||"symbol"===D.fileType||"image"===D.fileType)&&ht.Default.getImage(D.getImage())!==ht.Default.getImage("editor.unknown")){var Q=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(D.getImage(),Q,Q,"centerUniform",D,P.view,null,ht.Default.devicePixelRatio),this.$59$(w),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else"exit"===f||"cancel"===f?(this._topDiv.style.border="",this.removeDragImage()):"over"===f?this.$59$(w):"drop"===f&&(this._topDiv.style.border="",D&&(this.removeDragImage(),this.sm().cs(),m.handleDropToEditView?m.handleDropToEditView(this,D,this.lp(w),w):m.isSelected(D)?m.sm().toSelection().each(function(f){S.$100$(f,w)}):this.$100$(D,w)))},f.prototype.$100$=function(w,f){var P=this.lp(f);if("model"===w.fileType){var S=new ht.Node;S.s({shape3d:w.url}),S.setAnchor3d(.5,0,.5),S.setPosition(P),this.dm().add(S),this.sm().ss(S)}else if("symbol"===w.fileType||"image"===w.fileType){var m=new ht.Node;m.s({shape3d:"billboard","shape3d.image":w.url,"shape3d.image.cache":!1,"shape3d.autorotate":!0,"shape3d.alwaysOnTop":!1,"shape3d.fixSizeOnScreen":[-1,-1]}),m.setAnchor3d(.5,0,.5),m.p(P),m.setImage(w.url),this.dm().add(m),this.sm().ss(m)}},f}(ht.graph.GraphView),z=hteditor.combineShapes,J=hteditor.splitShape,X={width:20,height:16,comps:[{type:"image",stretch:"uniform",color:{func:function(w,f){if(w instanceof ht.Node){var P=w.s("shape3d")
;if(ht.Default.isString(P)&&hteditor.isJSON(P))return null}return hteditor.config.color_dark}},name:{func:function(w,f){if(w instanceof ht.Shape)return w.getThickness()>0?"hxeditor.wall":"hxeditor.floor";if(w instanceof ht.Node){var P=w.s("shape3d");if(P){if(ht.Default.isString(P)&&hteditor.isJSON(P))return P.substr(0,P.length-4)+"png";if("sphere"===P)return"hxeditor.sphere";if("cylinder"===P)return"hxeditor.cylinder"}return"hxeditor.cube"}return w.getIcon()}},rect:[0,0,20,16]}]},v=hteditor.getString,U={box:"editor.box",sphere:"editor.sphere",cone:"editor.cone",torus:"editor.torus",cylinder:"editor.cylinder",star:"editor.star",rect:"editor.rect",roundRect:"editor.roundrect",triangle:"editor.triangle",rightTriangle:"editor.righttriangle",parallelogram:"editor.parallelogram",trapezoid:"editor.trapezoid"},A=function(w){function f(P){I(this,f);var S=o(this,w.call(this,P,P.dm));return S.initMenu(),S}return a(f,w),f.prototype.handleDelete=function(){this.removeSelection()},f.prototype.onDataDoubleClicked=function(w,f){f.altKey?this.editor.gv.fitData(w,!0,hteditor.config.fitDataPadding):(this.editor.gv.makeCenter(w,!0),this.editor.scene.flyTo(w,{animation:!0}))},f.prototype.getLabel=function(f){var P=w.prototype.getLabel.call(this,f);if(!P){var S=f.s("shape3d");f instanceof ht.Shape?P=v("cylinder"===S?"editor.pipeline":f.getThickness()>0?"editor.wall":"editor.floor"):f instanceof ht.Node&&((P=v(U[S]))||(P=hteditor.isJSON(S)?hteditor.fileNameToDisplayName(S):S)),P||(P=v("editor.cube"))}return P||""},f.prototype.getIcon=function(w){return X},f.prototype._endDrag=function(w,f){var P=this,S=f.type,m=f.parent,D=f.refData;if(this.isSelected(this.draggingData)){var Q=this.getTopRowOrderSelection();"down"===S&&Q.reverse(),Q.each(function(w){P._dropData(w,S,m,D)})}else this._dropData(this.draggingData,S,m,D),this.sm().ss(this.draggingData);m&&this.expand(m)},f.prototype._dropData=function(w,f,P,S){if(w.setParent(P),"down"===f||"up"===f){var m=P?P.getChildren():this.dm().getRoots(),D=m.indexOf(S);"down"===f&&D++,m.indexOf(w)<D&&D--,this.dm().moveTo(w,D)}else P||this.dm().moveToBottom(w)},f.prototype.isEditable=function(w){return!0},f.prototype.rename=function(w,f){w.setDisplayName(f)},f.prototype.initMenu=function(){var w=this,f=function(){for(var f=w.editor.sm.getSelection(),P=0,S=f.length;P<S;P++)if(!(f.get(P)instanceof ht.Shape))return!1;return!0};this.menu=new ht.widget.ContextMenu;var P=[{id:"combine",label:v("editor.combineshapes"),action:function(){w.editor.beginTransaction(),z(w.editor.sm.getSelection().toArray(),w.editor.ld.getClass()),w.editor.endTransaction()},visible:function(){return w.editable&&w.editor.sm.size()>1&&f()}},{id:"splitShape",label:v("editor.splitshape"),action:function(){w.editor.beginTransaction(),J(w.editor.ld,w.editor.ld.getClass()),w.editor.endTransaction()},visible:function(){return w.editable&&1===w.editor.sm.size()&&w.editor.ld instanceof ht.Shape}}];this.menu.setItems(P),this.menu.addTo(this.getView()),this.editor.menus.push(this.menu)},f}(hteditor.DNDTree),r=function(w){function f(P){return I(this,f),o(this,w.call(this,P))}return a(f,w),f.prototype.commit=function(){this.editor.reset(!0),this.editor.dm.disableHistoryManager(),this.editor.deserialize(this.content),this.editing=!1,this.editor.dm.enableHistoryManager(),this.editor.dm.clearHistoryManager()},f.prototype.updateContent=function(){this.visible&&!this.editing&&(this._updateContentLater=!1,this.content=this.editor.serialize())},f.prototype.updateUrl=function(){this.v("url",this.editor.url||"")},f.prototype.$6$=function(){},f}(hteditor.DataView),n=hteditor.getString,M=function(w){function f(P){I(this,f);var S=o(this,w.call(this));S.editor=P,S.buttons={};var m=[];m.push(S.createItem("cluster",n("editor.align.cluster"),[{type:"shape",points:[5,2,11,2,5,14,11,14],segments:[1,2,1,2],borderWidth:3,borderColor:hteditor.config.color_select},{type:"shape",points:[8,5,8,11,5,8,11,8],segments:[1,2,1,2],borderWidth:1,borderColor:hteditor.config.color_dark}])),m.push(S.createItem("distributeHorizontal",n("editor.align.distributehorizontal"),[{type:"shape",points:[2,2,2,14,14,2,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[8,5,8,11],borderWidth:3}])),m.push(S.createItem("distributeVertical",n("editor.align.distributevertical"),[{type:"shape",points:[2,2,14,2,2,14,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[5,8,11,8],borderWidth:3}])),m.push(S.createItem("alignLeft",n("editor.align.alignleft"),[{type:"shape",points:[2,2,2,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,13,5,5,11,8,11],segments:[1,2,1,2],borderWidth:3}])),m.push(S.createItem("alignHorizontal",n("editor.align.alignhorizontal"),[{type:"shape",points:[8,2,8,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,13,5,6,11,10,11],segments:[1,2,1,2],borderWidth:3}])),m.push(S.createItem("alignRight",n("editor.align.alignright"),[{type:"shape",points:[14,2,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,11,5,11,11,8,11],segments:[1,2,1,2],borderWidth:3}])),m.push(S.createItem("alignTop",n("editor.align.aligntop"),[{type:"shape",points:[2,2,14,2],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,5,13,11,5,11,8],segments:[1,2,1,2],borderWidth:3}])),m.push(S.createItem("alignVertical",n("editor.align.alignvertical"),[{type:"shape",points:[2,8,14,8],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,13,11,6,11,10],segments:[1,2,1,2],borderWidth:3}])),m.push(S.createItem("alignBottom",n("editor.align.alignbottom"),[{type:"shape",points:[2,14,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,11,11,11,11,8],segments:[1,2,1,2],borderWidth:3}]));var D=.1,Q=[D,D,D,D,D,D,D,D,D];return S.addRow(m,Q),S.updateItems(),S.editor.sm.ms(function(){return S.updateItems()}),S}return a(f,w),f.prototype.createItem=function(w,f,P){var S=this;P.forEach(function(w){w.borderCap="round"}),P[0].borderColor=P[0].borderColor||hteditor.config.color_dark,P[1].borderColor=P[1].borderColor||hteditor.config.color_select;var m={width:16,height:16,fitSize:!0,comps:P};return this.buttons[w]=hteditor.createButton(null,f,m,function(){S[w]()})},f.prototype.updateItems=function(){var w=[];this.editor.sm.each(function(f){f instanceof ht.Node&&w.push(f)}),w.length>2?(this.buttons.cluster.setDisabled(!1),this.buttons.distributeHorizontal.setDisabled(!1),this.buttons.distributeVertical.setDisabled(!1),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):w.length>1?(this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):(this.buttons.cluster.setDisabled(!0),this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!0),this.buttons.alignHorizontal.setDisabled(!0),this.buttons.alignRight.setDisabled(!0),this.buttons.alignTop.setDisabled(!0),this.buttons.alignVertical.setDisabled(!0),this.buttons.alignBottom.setDisabled(!0))},f.prototype.getUnionRect=function(w){return this.editor.gv?this.editor.gv.getUnionNodeRect(w):null},f.prototype.isSelected=function(w){return this.editor.sm.contains(w)},f.prototype.hasSelectedGroupParent=function(w){return hteditor.InspectorTool.prototype.hasSelectedGroupParent.apply(this,arguments)},f.prototype.hasSelectedHost=function(w){return hteditor.InspectorTool.prototype.hasSelectedHost.apply(this,arguments)},f.prototype.cluster=function(){var w=this.selection;if(w.length){this.editor.beginTransaction(),this.alignHorizontal(),this.alignVertical();var f=void 0,P=void 0;w.forEach(function(w){void 0===f?f=P=w.getElevation():(f>w.getElevation()&&(f=w.getElevation()),P<w.getElevation()&&(P=w.getElevation()))}),w.sort(function(w,f){return w.getElevation()-f.getElevation()});for(var S=(P-f)/(w.length-1),m=1;m<w.length-1;m++)w[m].setElevation(f+m*S);this.editor.endTransaction()}},f.prototype.distributeHorizontal=function(){hteditor.InspectorTool.prototype.distributeHorizontal.apply(this,arguments)},f.prototype.distributeVertical=function(){hteditor.InspectorTool.prototype.distributeVertical.apply(this,arguments)},f.prototype.alignLeft=function(){hteditor.InspectorTool.prototype.alignLeft.apply(this,arguments)},f.prototype.alignHorizontal=function(){hteditor.InspectorTool.prototype.alignHorizontal.apply(this,arguments)},f.prototype.alignRight=function(){hteditor.InspectorTool.prototype.alignRight.apply(this,arguments)},f.prototype.alignTop=function(){hteditor.InspectorTool.prototype.alignTop.apply(this,arguments)},f.prototype.alignVertical=function(){hteditor.InspectorTool.prototype.alignVertical.apply(this,arguments)},f.prototype.alignBottom=function(){hteditor.InspectorTool.prototype.alignBottom.apply(this,arguments)},c(f,[{key:"selection",get:function(){var w=this,f=[];return this.editor.sm.each(function(P){P instanceof ht.Node&&(w.hasSelectedGroupParent(P.getParent())||w.hasSelectedHost(P)||f.push(P))}),f}}]),f}(ht.widget.FormPane),L=function(w){function f(P,S){var m=arguments.length>2&&void 0!==arguments[2]&&arguments[2];I(this,f);var D=o(this,w.call(this,P,S,S,m));return D.setHPadding(8),D.setVPadding(4),D.addUpdateHandler(function(){D.initDataBindings()}),D}return a(f,w),f.prototype.initForm=function(){w.prototype.initForm.call(this),this.addCustomProperties()},f.prototype.addTitle=function(w,f){var P=this._oldTitle;this.editor.fireEvent("titleCreating",{oldTitle:P,title:w,inspector:this});var S=[],m=hteditor.getString("editor."+w.toLowerCase(),!0)||hteditor.getString(w);S.push({element:m,font:hteditor.config.boldFont}),f=f||{},f.title=w,f.background=hteditor.config.color_pane_dark;var D=this.addRow(S,[.1],null,f);return this._oldTitle=w,this.editor.fireEvent("titleCreated",{oldTitle:P,title:w,inspector:this}),D},f.prototype.addOneRow=function(w,f,P){for(var S=[this.indent,.1],m=2,D=w.length;m<D;m++)S.push(20);var Q=this.addRow(w,S,f?this.getRowHeight()*f:null,P);return Q.index=this.getRows().length-1,Q},f.prototype.addDBRow=function(w,f,P,S,m){var D=this,Q=void 0;if(d.config.dataBindings&&(!d.config.dataBindings.filter||d.config.dataBindings.filter(f,P))){var B=function(){d.config.dataBindings.onButtonClicked(D.data,f,P)},C=f+":"+P,p=this.addButton(w,null,C,null,B,!0);this.updateHandlers.push(function(){if(!w.hidden&&D.data){var S=d.config.isDataBound(D.data,f,P);p.setIcon(S?"editor.bind.state":"editor.unbind.state")}})}return Q=this.addOneRow(w,m,S),Q.keys={name:P,displayName:this.toDisplayName(w),accessType:f},Q},f.prototype.initDataBindings=function(){var w=this,f=this._dataBindingRowInfos;f&&f.length>0&&(this.removeRows(f),this._dataBindingRowInfos=null);var P=this._dataBindingHandlers;P&&P.length>0&&(P.forEach(function(f){w.removeUpdateHandler(f)}),this._dataBindingHandlers=null);var S=this.data;if(S){var m=[S.s("all.image"),S.s("top.image"),S.s("bottom.image"),S.s("left.image"),S.s("right.image"),S.s("front.image"),S.s("back.image"),S.s("shape3d.image"),S.s("shape3d.top.image"),S.s("shape3d.bottom.image"),S.s("shape3d.from.image"),S.s("shape3d.to.image")],D=[];if(m.forEach(function(w){w&&D.push(ht.Default.getImage(w))}),0!==D.length){for(var Q=[],B=!1,C=0,p=D.length;C<p;C++){var d=D[C];if(!d){B=!0;break}d.dataBindings&&Q.push.apply(Q,d.dataBindings)}if(B){var E=ht.Default.handleImageLoaded;return void(ht.Default.handleImageLoaded=function(){for(var f=arguments.length,P=Array(f),S=0;S<f;S++)P[S]=arguments[S];E.apply(ht.Default,P),w.initDataBindings(),ht.Default.handleImageLoaded=E})}if(0!==Q.length){var I=this.updateHandlers.length;f=[this.addTitle(hteditor.getString("DataBindings"))];var c={};Q.forEach(function(P){var S=P.attr;if(!c[S]){c[S]=1;var m=w.$88$(P);f.push(w.addDBRow(m,"a",S))}}),this._dataBindingRowInfos=f,this._dataBindingHandlers=this.updateHandlers.slice(I),this._dataBindingHandlers.forEach(function(w){w()})}}}},f.prototype.$88$=function(w){var f=[],P=w.attr,S=hteditor.config.valueTypes[w.valueType];if(!S)return this.editor.fireEvent("error",{message:"Wrong value type:"+w.valueType,dataBind:w}),!1;var m=hteditor.getString(w.name)||P,D=function(w){return w.a(P)},Q=function(w,f){return w.a(P,f)};return"int"===S.type||"number"===S.type?S.angle?this.addLabelRotation(f,m,D,Q,S.min,S.max,S.step):this.addLabelRange(f,m,D,Q,S.min,S.max,S.step,S.type):"color"===S.type?this.addLabelColor(f,m,D,Q):"boolean"===S.type?this.addLabelCheckBox(f,m,D,Q):"enum"===S.type?this.addLabelComboBox(f,m,D,Q,S.values,S.labels,S.icons):"multiline"===S.type?this.addLabelMultiline(f,m,D,Q):"font"===S.type?this.addLabelFont(f,m,D,Q):"image"===S.type?this.addLabelImage(f,m,D,Q):"url"===S.type?this.addLabelURL(f,m,D,Q):"colorArray"===S.type?this.addLabelArray(f,m,D,Q,"color"):"numberArray"===S.type?this.addLabelArray(f,m,D,Q,"number"):"stringArray"===S.type?this.addLabelArray(f,m,D,Q,"string"):"objectArray"===S.type?this.addLabelArray(f,m,D,Q,"object"):"function"===S.type?this.addLabelFunction(f,m,D,Q,P):"object"===S.type?this.addLabelObject(f,m,D,Q,P):this.addLabelInput(f,m,D,Q),f},f.prototype.addLabelData=function(w,f,P,S){var m=this,D=this.addLabelInput(w,f,function(w){var f=P(w);return f?f.toLabel()||f.getClassName():""}),Q=D.getElement();D.isDroppable=function(w,f){return f.view.draggingData&&m.dataModel===f.view.draggingData.getDataModel()},D.handleCrossDrag=function(w,f,P){"enter"===f?Q.style.border="solid "+d.config.color_select_dark+" 2px":"exit"===f||"cancel"===f?Q.style.border="":"over"===f||"drop"===f&&(Q.style.border="",m.setValue(S,P.view.draggingData),D.setFocus())},Q.onkeydown=function(w){ht.Default.isDelete(w)&&m.setValue(S,null)};var B=new ht.widget.Image;B.drawImage=function(w,f,P,S,D,Q){var C=B.data,p=m.editor.list;C&&p&&p.dm().contains(C)&&(f=p.getIcon(C))&&drawStretchImage(w,ht.Default.getImage(f),"centerUniform",P,S,D,Q,C,p)},this.updateHandlers.push(function(){if(!w.hidden){var f=B.data;B.data=m.getValue(P),B.fp("data",f,B.data)}}),w.push(B)},f.prototype.addLabelComboBoxURL=function(w,f,P,S,m,D,Q,B){var C=this,p=this.addLabelComboBox(w,f,P,S,m,D,Q);if(S){p.setEditable(!0);var E=p.getView();p.isDroppable=B||function(w,f){return!!f.view.draggingData},p.handleCrossDrag=function(w,f,P){if("enter"===f)E.style.border="solid "+d.config.color_select_dark+" 2px";else if("exit"===f||"cancel"===f)E.style.border="";else if("over"===f);else if("drop"===f){E.style.border="";var m=E.value=P.view.draggingData.uuid;p.setFocus(),C.setValue(S,m)}}}return p},f.prototype.addImage=function(w,f,P,S,m){var D=this,Q=new ht.widget.Image;Q.vectorDataBindingDisabled=!0;var B=S||function(w){var f=ht.Default.getImage(w);return f&&f.snapshotURL?f.snapshotURL:w};this.updateHandlers.push(function(){if(!w.hidden){var P=D.getValue(f);Q.rawIcon=P,Q.setIcon(B(P))}});var C=Q.getView();C.style.cursor="pointer";var p=function(w){w.preventDefault(),m&&!m(Q)||(ht.Default.isDoubleClick(w)?D.editor.open(Q.rawIcon):D.editor.selectFileNode(Q.rawIcon))};return C.addEventListener("mousedown",p,!1),C.addEventListener("touchstart",p,!1),w.push(Q),Q},c(f,[{key:"type",set:function(w){this._type=w},get:function(){return this._type}},{key:"dataModel",get:function(){return this.editor.dm}},{key:"indent",get:function(){return hteditor.config.indent}},{key:"indent2",get:function(){return hteditor.config.indent2}}]),f}(hteditor.Inspector),G=ht.Default.preventDefault,H=ht.Default.isLeftButton,K=ht.Default.isMiddleButton,O=ht.Default.getTouchCount,Z=ht.Default.isCtrlDown,Y=ht.Default.isShiftDown,t=ht.Default.getClientPoint,j=function(w){var f=w.touches[0],P=w.touches[1],S=f.clientX,m=f.clientY,D=P.clientX,Q=P.clientY;return Math.sqrt((S-D)*(S-D)+(m-Q)*(m-Q))},b=function(w){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w},ww="undefined"!=typeof Float32Array?Float32Array:Array,fw=function(){return b(new ww(16))},Pw=Math.abs,Sw=Math.sqrt,mw=function(w,f,P,S){var m,D,Q,B,C,p,d,E,I,c,a=f[0],o=f[1],s=f[2],e=S[0],T=S[1],N=S[2],x=P[0],W=P[1],y=P[2];return Pw(a-x)<1e-6&&Pw(o-W)<1e-6&&Pw(s-y)<1e-6?b(w):(d=a-x,E=o-W,I=s-y,c=1/Sw(d*d+E*E+I*I),d*=c,E*=c,I*=c,m=T*I-N*E,D=N*d-e*I,Q=e*E-T*d,c=Sw(m*m+D*D+Q*Q),c?(c=1/c,m*=c,D*=c,Q*=c):(m=0,D=0,Q=0),B=E*Q-I*D,C=I*m-d*Q,p=d*D-E*m,c=Sw(B*B+C*C+p*p),c?(c=1/c,B*=c,C*=c,p*=c):(B=0,C=0,p=0),w[0]=m,w[1]=B,w[2]=d,w[3]=0,w[4]=D,w[5]=C,w[6]=E,w[7]=0,w[8]=Q,w[9]=p,w[10]=I,w[11]=0,w[12]=-(m*a+D*o+Q*s),w[13]=-(B*a+C*o+p*s),w[14]=-(d*a+E*o+I*s),w[15]=1,w)},Dw=function(w){function f(P){return I(this,f),o(this,w.call(this,P))}return a(f,w),f.prototype.handle_contextmenu=function(w){G(w)},f.prototype.handle_mousewheel=function(w){this.gv.handleScroll(w,w.wheelDelta/40)},f.prototype.handle_DOMMouseScroll=function(w){2===w.axis&&this.gv.handleScroll(w,-w.detail)},f.prototype.handle_keydown=function(w){this.gv.handleKeyDown(w)},f.prototype.handle_mousedown=function(w){this.handle_touchstart(w)},f.prototype.handle_touchstart=function(w){G(w);var f=this,P=f.gv,S=H(w),m=K(w),D=P.getDataInfoAt(w),Q=D?D.data:null,B=D?D.part:null,C=P.sm(),p=O(w),d=1===p;P.setFocus(w)&&(f.state=null,f.pendingCS=null,Q?Z(w)?C.co(Q)?C.rs(Q):C.as(Q):C.co(Q)||C.ss(Q):S&&(f.pendingCS=t(w)),f.state||((S||m)&&d&&!Q?f.state="pan":S&&d&&Q instanceof ht.Node&&P.isSelected(Q)?P.isMovable(Q)&&(f.state="move",f.p3=Q.p3(),f.movedata=Q):ht.Default.isTouchable&&(p>2?f.state="pan":2===p&&(f.dist=j(w),f.state="pinch"))),f.point=P.lp(w),ht.Default.startDragging(f,w),ht.Default.isDoubleClick(w)?P.handleDoubleClick(w,Q,B):P.handleClick(w,Q,B))},f.prototype.handle_mouseup=function(w){this.handle_touchend(w)},f.prototype.handle_touchend=function(w){var f=this.pendingCS;f&&(ht.Default.getDistance(f,t(w))<=1&&this.gv.sm().cs(),this.pendingCS=null)},f.prototype.handleWindowMouseMove=function(w){this.handleWindowTouchMove(w)},f.prototype.handleWindowTouchMove=function(w){var f=this,P=f.gv,S=f.state,m=f.point,D=P.dm(),Q=P.lp(w),B=Q.x-m.x,C=Q.y-m.y,p=P.getWidth(),d=P.getHeight();if(p&&d){if("move"===S){P._moving||D.beginTransaction(),P.fi({kind:P._moving?"betweenMove":"beginMove",event:w}),P._moving=1;var E=f.p3,I=P.getPositionInfo(E),c=mw(fw(),P._eye,P._center,P._up);B=B/p*I.width,C=-1*C/d*I.height;var a=[c[0]*B,c[4]*B,c[8]*B],o=[c[1]*C,c[5]*C,c[9]*C],s=a[0]+o[0],e=a[1]+o[1],T=a[2]+o[2],N=[E[0]+s,E[1]+e,E[2]+T];P.moveSelection(s,e,T),f.p3=N}else if("pinch"===S&&2===O(w)){P.fi({kind:P._pinching?"betweenPinch":"beginPinch",event:w}),P._pinching=1;var x=j(w);P.handlePinch(x,f.dist),f.dist=x}else("pan"===S||Y(w))&&f.pan(w,B,C);f.point=Q}},f.prototype.pan=function(w,f,P){var S=this.gv;if(S.isPannable()){var m=S.getWidth(),D=S.getHeight();if(!m||!D)return;var Q=S.getCenterInfo(),B=f/m*Q.width,C=-1*P/D*Q.height;S.fi({kind:S._panning?"betweenPan":"beginPan",event:w}),S._panning=1,S.pan(-B,-C)}},f.prototype.handleWindowMouseUp=function(w){this.handleWindowTouchEnd(w)},f.prototype.handleWindowTouchEnd=function(w){var f=this,P=f.gv,S=P.dm();P._moving&&(delete P._moving,P.fi({kind:"endMove",event:w}),P.onMoveEnded(),S.endTransaction()),P._panning&&(delete P._panning,P.fi({kind:"endPan",event:w}),P.onPanEnded()),P._pinching&&(delete P._pinching,P.fi({kind:"endPinch",event:w}),P.onPinchEnded()),f.dist=f.point=f.state=f.p3=f.movedata=f.pendingCS=null},f}(ht.graph3d.Interactor),Qw=hteditor.getString,Bw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"scene",!0))}return a(f,w),f.prototype.initForm=function(){var f=this;w.prototype.initForm.call(this);var P=void 0;this.addTitle(Qw("editor.titlescenes")),P=[],this.addLabelInput(P,Qw("editor.vertices"),function(){var w=f.editor.scene.getRenderInfo();return w?w.vertices:""}),this.addLabelInput(P,Qw("editor.faces"),function(){var w=f.editor.scene.getRenderInfo();return w?w.faces:""}),this.addRow(P,[this.indent,.1,this.indent2,.1]),P=[],this.addLabelInput(P,Qw("editor.previewurl"),hteditor.getter("a","previewURL"),hteditor.setter("a","previewURL")),this.addRow(P,[this.indent,.1]),P=[],P.push(Qw("editor.camera")),this.addButton(P,null,Qw("editor.reset"),"editor.resetsize.state",function(){f.editor.scene.setEye(ht.Default.graph3dViewEye)}),this.addLabelInput(P,"X",function(w){return parseFloat(f.editor.scene.getEye()[0])},function(w,P){var S=f.editor.scene.getEye();f.editor.scene.setEye(P,S[1],S[2])},"int",1),this.addLabelInput(P,"Y",function(w){return parseFloat(f.editor.scene.getEye()[1])},function(w,P){var S=f.editor.scene.getEye();f.editor.scene.setEye(S[0],P,S[2])},"int",1),this.addLabelInput(P,"Z",function(w){return parseFloat(f.editor.scene.getEye()[2])},function(w,P){var S=f.editor.scene.getEye();f.editor.scene.setEye(S[0],S[1],P)},"int",1),this.addRow(P,[this.indent-40-8,20,20,.1,20,.1,20,.1]),P=[],P.push(Qw("editor.center")),this.addButton(P,null,Qw("editor.reset"),"editor.resetsize.state",function(){f.editor.scene.setCenter(ht.Default.graph3dViewCenter)}),this.addLabelInput(P,"X",function(w){return parseFloat(f.editor.scene.getCenter()[0])},function(w,P){var S=f.editor.scene.getCenter();f.editor.scene.setCenter(P,S[1],S[2])},"int",1),this.addLabelInput(P,"Y",function(w){return parseFloat(f.editor.scene.getCenter()[1])},function(w,P){var S=f.editor.scene.getCenter();f.editor.scene.setCenter(S[0],P,S[2])},"int",1),this.addLabelInput(P,"Z",function(w){return parseFloat(f.editor.scene.getCenter()[2])},function(w,P){var S=f.editor.scene.getCenter();f.editor.scene.setCenter(S[0],S[1],P)},"int",1),this.addRow(P,[this.indent-40-8,20,20,.1,20,.1,20,.1]),P=[],this.addLabelRange(P,Qw("editor.near"),function(){return f.editor.scene.getNear()},function(w,P){f.editor.scene.setNear(P)},1,void 0,1,"int"),this.addLabelRange(P,Qw("editor.far"),function(){return f.editor.scene.getFar()},function(w,P){f.editor.scene.setFar(P)},0,void 0,100,"int"),this.addRow(P,[this.indent,.1,this.indent2,.1]),P=[],this.addLabelColor(P,Qw("editor.backgroundcolor"),hteditor.getter("p","background"),hteditor.setter("p","background")),this.addRow(P,[this.indent,.1]),P=[],this.addLabelColor(P,Qw("editor.gridcolor"),function(w){var P=f.editor.scene.getGridColor();return P instanceof Array?"rgba("+Math.floor(255*P[0])+","+Math.floor(255*P[1])+","+Math.floor(255*P[2])+","+P[3]+")":f.editor.scene.getGridColor()},function(w,P){f.editor.scene.setGridColor(P)}),this.addRow(P,[this.indent,.1]),P=[],this.addLabelRange(P,Qw("editor.gridsize"),function(w){return f.editor.scene.getGridSize()},function(w,P){f.editor.scene.setGridSize(P)},0,void 0,1,"int"),this.addLabelRange(P,Qw("editor.gridgap"),function(w){return f.editor.scene.getGridGap()},function(w,P){f.editor.scene.setGridGap(P),f.editor.gv.getEditInteractor().setStyle("gridBlockSize",P)},1,void 0,1,"int"),this.addRow(P,[this.indent,.1,this.indent2,.1]),P=[],this.addLabelImage(P,Qw("editor.envmapimage"),function(w){return w.getEnvmap()},function(w,f){return w.setEnvmap(f)}),this.addRow(P,[this.indent,.1,20]);var S=this.editor.scene,m=this.editor.scene.getHighlightHelper(),D=hteditor.config.valueTypes.HighlightEnum;P=[],this.addLabelComboBox(P,Qw("editor.highlight"),function(){return m.mode},function(w,f){m.mode=f},D.values,D.labels),this.addRow(P,[this.indent,.1]);var Q=[],B=S.getPostProcessingModule("Bloom"),C=void 0,p=function(){C!==B.enable&&(B.enable?Q.forEach(function(w,P){w.index=f.getRows().indexOf(d)+P+1,f.addRow(w.items,w.widths,w.height,w)}):f.removeRows(Q),C=B.enable)};P=[],this.addLabelCheckBox(P,Qw("editor.bloom"),function(){return B.enable},function(w,P){S.enablePostProcessing("Bloom",P),S.iv(),f.updateProperties()});var d=this.addOneRow(P);P=[],this.addLabelRange(P,Qw("editor.bloomstrength"),function(){return B.strength},function(w,P){B.strength=P,S.iv(),f.updateProperties()},0,void 0,.01,"number"),Q.push(this.addOneRow(P)),P=[],this.addLabelRange(P,Qw("editor.bloomradius"),function(){return B.radius},function(w,P){B.radius=P,S.iv(),f.updateProperties()},0,void 0,.01,"number"),Q.push(this.addOneRow(P)),P=[],this.addLabelRange(P,Qw("editor.bloomthreshold"),function(){return B.threshold},function(w,P){B.threshold=P,S.iv(),f.updateProperties()},0,1,.01,"number"),Q.push(this.addOneRow(P)),P=[];var E=["json","dm","gv"];this.addLabelFunction(P,Qw("editor.onpredeserialize"),function(w){return w.a("onPreDeserialize")},function(w,f){w.a("onPreDeserialize",f)},"onPreDeserialize",E),this.addOneRow(P),P=[],E=["json","dm","gv","datas"],this.addLabelFunction(P,Qw("editor.onpostdeserialize"),function(w){return w.a("onPostDeserialize")},function(w,f){w.a("onPostDeserialize",f)},"onPostDeserialize",E),this.addOneRow(P);var I=S.getMoveMode,c=function(){return"xyz"},a=new ht.Math.Vector3,o=new ht.Math.Vector3,s=new ht.Math.Vector3,e=function(w){if(w){a.fromArray(S.getCenter()),o.fromArray(S.getEye()),o.sub(a);var f=[0,1,0];"right"===w?f=[1,0,0]:"front"===w&&(f=[0,0,1]),s.fromArray(f).setLength(o.length()).add(a),S.setEye(s.toArray())}},T=S.getInteractors().toArray(),N=new Dw(S);P=[];var x=!1;this.addLabelComboBox(P,Qw("editor.orthographic"),function(){return x},function(w,f){x=f,S.setOrtho(!!f),f?(S.getMoveMode=c,S.setInteractors([N]),e(x)):(S.getMoveMode=I,S.setInteractors(T.slice(0))),S.setRotatable(!f),S.setResettable(!f),S.setWalkable(!f),S.setEditHelperDisabled(!!f)},[!1,"top","right","front"],[Qw("editor.none"),Qw("editor.viewtype.top"),Qw("editor.viewtype.right"),Qw("editor.viewtype.front")]),this.addOneRow(P);var W=S.getPostProcessingModule("Dof"),y=[],$=void 0,k=function(){$!==W.enable&&(W.enable?y.forEach(function(w,P){w.index=f.getRows().indexOf(u)+P+1,f.addRow(w.items,w.widths,w.height,w)}):f.removeRows(y),$=W.enable)};P=[],this.addLabelCheckBox(P,Qw("editor.dof"),function(w){return W.enable},function(w,P){S.enablePostProcessing("Dof",P),P&&!W.image&&ht.Default.xhrLoad("assets/Depth.png",function(){W.image="assets/Depth.png",f.updateProperties()}),S.iv(),f.updateProperties()});var u=this.addOneRow(P);P=[],this.addLabelImage(P,Qw("editor.dof.image"),function(w){return W.image},function(w,P){W.image=P,f.updateProperties()}),y.push(this.addOneRow(P)),P=[],this.addLabelRange(P,Qw("editor.dof.aperture"),function(w){return parseFloat(W.aperture)},function(w,P){W.aperture=P,f.updateProperties()},0,1,.001,"number"),y.push(this.addOneRow(P)),this.addUpdateHandler(function(){p(),k()})},f}(L),Cw=hteditor.getString,pw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"data",!1))}return a(f,w),f.prototype.initForm=function(){w.prototype.initForm.call(this),this.$12$(),this.addWireframeProperties(),this.addTransformProperties()},f.prototype.$12$=function(){var w=this;this.addTitle(Cw("editor.titlebasic"));var f=[];this.addLabelInput(f,Cw("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(f,Cw("editor.tag"),hteditor.getter("p","tag"),hteditor.setter("p","tag")),this.addRow(f,[this.indent,.1,this.indent2,.1]),f=[],this.addLabelURL(f,Cw("editor.navigate"),function(w){return w.a("navigate")||""},function(w,f){w.a("navigate",f)},function(w,f){var P=f.view.draggingData;return P&&("scene"===P.fileType||"display"===P.fileType)}),this.addLabelInput(f,Cw("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(f,[this.indent,.1,this.indent2,.1]),f=[],this.addLabelComboBoxURL(f,Cw("editor.type"),function(w){return w.s("shape3d")},function(f,P){f.s("shape3d",P),w.editor.updateInspector()},["","billboard","plane","cone","cylinder","roundRect","sphere","torus","triangle"],void 0,void 0,function(w,f){return!!f.view.draggingData&&"model"===f.view.draggingData.fileType}),this.addImage(f,function(w){return w.s("shape3d")},void 0,function(w){return hteditor.isJSON(w)?w.substr(0,w.length-5)+".png":null},function(w){return hteditor.isJSON(w.rawIcon)}),this.addOneRow(f),f=[],this.addLabelCheckBox(f,Cw("editor.selectable"),function(w){return w.s("3d.selectable")},function(w,f){w.s("2d.selectable",f),w.s("3d.selectable",f)}),this.addLabelCheckBox(f,Cw("editor.movable"),function(w){return w.s("3d.movable")},function(w,f){w.s("2d.movable",f),w.s("3d.movable",f)}),this.addRow(f,[this.indent,.1,this.indent2,.1]),f=[],this.addLabelCheckBox(f,Cw("editor.editable"),function(w){return w.s("3d.editable")},function(w,f){w.s("2d.editable",f),w.s("3d.editable",f)}),this.addLabelCheckBox(f,Cw("editor.visible"),function(w){return w.s("3d.visible")},function(w,f){w.s("2d.visible",f),w.s("3d.visible",f)}),this.addRow(f,[this.indent,.1,this.indent2,.1]),f=[],this.addLabelCheckBox(f,Cw("editor.interactive"),function(w){return w.s("interactive")},function(w,f){return w.s("interactive",f)}),this.addRow(f,[this.indent,.1]),f=[],this.addLabelRange(f,Cw("editor.envmap"),function(w){return w.s("envmap")||0},hteditor.setter("s","envmap"),0,1,.01,"number"),this.addRow(f,[this.indent,.1]),f=[],this.addLabelRange(f,Cw("editor.brightness"),function(w){return w.s("select.brightness")},hteditor.setter("s","select.brightness"),0,1,.01,"number"),this.addRow(f,[this.indent,.1]),f=[],this.addLabelObject(f,Cw("editor.polygonoffset"),function(w){return w.s("polygonOffset")},hteditor.setter("s","polygonOffset"),"number"),this.addRow(f,[this.indent,.1])},f.prototype.addTransformProperties=function(){this.addTitle(Cw("editor.titletransform"));var w=d.config.numberPrecision,f=w.position||0,P=0===f?"int":"number",S=1/Math.pow(10,f),m=[];m.push(Cw("editor.position")),this.addButton(m,null,Cw("editor.reset"),"editor.resetsize.state",function(w){w instanceof ht.Node&&w.p3(0,0,0)}),this.addLabelInput(m,"X",function(w){return Number(w.getX().toFixed(f))},function(w,f){return w.setX(parseFloat(f))},P,S),this.addLabelInput(m,"Y",function(w){return Number(w.getElevation().toFixed(f))},function(w,f){return w.setElevation(parseFloat(f))},P,S),this.addLabelInput(m,"Z",function(w){return Number(w.getY().toFixed(f))},function(w,f){return w.setY(parseFloat(f))},P,S),this.addRow(m,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var D=w.rotation||0;P=0===D?"int":"number",S=1/Math.pow(10,D),m=[],m.push(Cw("editor.rotation")),this.addButton(m,null,Cw("editor.reset"),"editor.resetsize.state",function(w){w instanceof ht.Node&&w.r3(0,0,0)}),this.addLabelInput(m,"X",function(w){return Number((180/Math.PI*w.getRotationX()).toFixed(D))},function(w,f){w instanceof ht.Node&&w.setRotationX(f*Math.PI/180)},P,S),this.addLabelInput(m,"Y",function(w){return Number((180/Math.PI*w.getRotationY()).toFixed(D))},function(w,f){w instanceof ht.Node&&w.setRotationY(f*Math.PI/180)},P,S),this.addLabelInput(m,"Z",function(w){return Number((180/Math.PI*w.getRotationZ()).toFixed(D))},function(w,f){w instanceof ht.Node&&w.setRotationZ(f*Math.PI/180)},P,S),this.addRow(m,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var Q=w.size||0;P=0===Q?"int":"number",S=1/Math.pow(10,Q),m=[],m.push(Cw("editor.size")),this.addButton(m,null,Cw("editor.reset"),"editor.resetsize.state",function(w){w instanceof ht.Node&&w.s3(-1,-1,-1)}),this.addLabelInput(m,"X",function(w){return Number(w.getWidth().toFixed(Q))},function(w,f){return w.setWidth(parseFloat(f))},P,S),this.addLabelInput(m,"Y",function(w){return Number(w.getTall().toFixed(Q))},function(w,f){return w.setTall(parseFloat(f))},P,S),this.addLabelInput(m,"Z",function(w){return Number(w.getHeight().toFixed(Q))},function(w,f){return w.setHeight(parseFloat(f))},P,S),this.addRow(m,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var B=w.anchor||0;P=0===B?"int":"number",S=1/Math.pow(10,B),m=[],m.push(Cw("editor.anchor")),this.addButton(m,null,Cw("editor.reset"),"editor.resetsize.state",function(w){w instanceof ht.Node&&w.setAnchor3d(.5,0,.5,!0)}),this.addLabelInput(m,"X",function(w){return Number(w.getAnchorX().toFixed(B))},function(w,f){w instanceof ht.Node&&w.setAnchor3d(parseFloat(f),w.getAnchorElevation(),w.getAnchorY(),!0)},P,S),this.addLabelInput(m,"Y",function(w){
return Number(w.getAnchorElevation().toFixed(B))},function(w,f){w instanceof ht.Node&&w.setAnchor3d(w.getAnchorX(),parseFloat(f),w.getAnchorY(),!0)},P,S),this.addLabelInput(m,"Z",function(w){return Number(w.getAnchorY().toFixed(B))},function(w,f){w instanceof ht.Node&&w.setAnchor3d(w.getAnchorX(),w.getAnchorElevation(),parseFloat(f),!0)},P,S),this.addRow(m,[this.indent-40-8,20,20,.1,20,.1,20,.1]);var C=w.scale||0;P=0===C?"int":"number",S=1/Math.pow(10,C),m=[],m.push(Cw("editor.scale")),this.addButton(m,null,Cw("editor.reset"),"editor.resetsize.state",function(w){w instanceof ht.Node&&w.setScale3d(1,1,1)}),this.addLabelInput(m,"X",function(w){return Number(w.getScaleX().toFixed(C))},function(w,f){w instanceof ht.Node&&w.setScaleX(parseFloat(f))},P,S),this.addLabelInput(m,"Y",function(w){return Number(w.getScaleTall().toFixed(C))},function(w,f){w instanceof ht.Node&&w.setScaleTall(parseFloat(f))},P,S),this.addLabelInput(m,"Z",function(w){return Number(w.getScaleY().toFixed(C))},function(w,f){w instanceof ht.Node&&w.setScaleY(parseFloat(f))},P,S),this.addRow(m,[this.indent-40-8,20,20,.1,20,.1,20,.1])},f.prototype.addWireframeProperties=function(){this.addTitle(Cw("editor.titlewireframe"));var w=[];this.addLabelComboBox(w,Cw("editor.visible"),hteditor.getter("s","wf.visible"),function(w,f){w.s("wf.visible",f)},[!1,!0,"selected"]),this.addLabelCheckBox(w,Cw("editor.wfshort"),hteditor.getter("s","wf.short"),hteditor.setter("s","wf.short")),this.addRow(w,[this.indent,.1,this.indent2,.1]),w=[],this.addLabelColor(w,Cw("editor.color"),hteditor.getter("s","wf.color"),hteditor.setter("s","wf.color")),this.addRow(w,[this.indent,.1]),w=[],this.addLabelCheckBox(w,Cw("editor.wfgeometry"),hteditor.getter("s","wf.geometry"),hteditor.setter("s","wf.geometry")),this.addLabelCheckBox(w,Cw("editor.wfloadQuadWireframe"),hteditor.getter("s","wf.loadQuadWireframe"),hteditor.setter("s","wf.loadQuadWireframe")),this.addRow(w,[this.indent,.1,this.indent2,.1]),w=[],this.addLabelComboBox(w,Cw("editor.wfcombineTriangle"),hteditor.getter("s","wf.combineTriangle"),hteditor.setter("s","wf.combineTriangle"),[!1,!0,2,3],[Cw("editor.wfdontcombine"),Cw("editor.wfcombineadjacent"),Cw("editor.wfcombinecommon"),Cw("editor.wfcombinesmooth")]),this.addRow(w,[this.indent,.1])},f}(L),dw=hteditor.getString,Ew=["all","front","back","left","right","top","bottom"],Iw=function(w,f,P){return function(S){var m=S.s(w+"."+f);return P&&void 0===m?S.s("all."+f):m}},cw=function(w){return function(f){var P=f.s(w);return P||(P=f.s("all.uv.scale")),P?P[0]:1}},aw=function(w){return function(f,P){var S=f.s(w);S||(S=f.s("all.uv.scale")),f.s(w,[P,S?S[1]:1])}},ow=function(w){return function(f){var P=f.s(w);return P||(P=f.s("all.uv.scale")),P?P[1]:1}},sw=function(w){return function(f,P){var S=f.s(w);S||(S=f.s("all.uv.scale")),f.s(w,[S?S[0]:1,P])}},ew=function(w){return function(f){f.s(w,null)}},Tw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"Cube"))}return a(f,w),f.prototype.initForm=function(){w.prototype.initForm.call(this),this.addCubeProperties()},f.prototype.addCubeProperties=function(){var w=void 0,f=void 0,P=0,S=new ht.widget.TabView;f=new ht.widget.FormPane;for(var m=0;m<Ew.length;m++){var D=Ew[m]+".image";w=[],this.addLabelImage(w,dw("editor.face."+Ew[m]),Iw(Ew[m],"image"),hteditor.setter("s",D)),f.addRow(w,[this.indent,.1,20])}C(S,dw("editor.image"),f,!0),f.validateImpl(),P=Math.max(P,f.getScrollHeight()),f=new ht.widget.FormPane;for(var m=0;m<Ew.length;m++){var Q=Ew[m]+".uv.scale";w=[],this.addLabel(w,dw("editor.face."+Ew[m])),this.addButton(w,null,dw("editor.reset"),"editor.resetsize.state",ew(Q)),this.addLabelInput(w,"U",cw(Q),aw(Q),"number",1),this.addLabelInput(w,"V",ow(Q),sw(Q),"number",1),f.addRow(w,[this.indent-20-8,20,20,.1,20,.1])}C(S,dw("editor.repeat"),f,!0),f.validateImpl(),P=Math.max(P,f.getScrollHeight()),f=new ht.widget.FormPane;for(var m=0;m<Ew.length;m++){var B=Ew[m]+".color";w=[],this.addLabelColor(w,dw("editor.face."+Ew[m]),Iw(Ew[m],"color"),hteditor.setter("s",B)),f.addRow(w,[this.indent,.1])}C(S,dw("editor.color"),f),f.validateImpl(),P=Math.max(P,f.getScrollHeight()),f=new ht.widget.FormPane;for(var m=0;m<Ew.length;m++){var p=Ew[m]+".transparent";w=[],this.addLabelCheckBox(w,dw("editor.face."+Ew[m]),Iw(Ew[m],"transparent"),hteditor.setter("s",p)),f.addRow(w,[this.indent,.1])}C(S,dw("editor.transparent"),f),f.validateImpl(),P=Math.max(P,f.getScrollHeight()),f=new ht.widget.FormPane;for(var m=0;m<Ew.length;m++){var d=Ew[m]+".visible";w=[],this.addLabelCheckBox(w,dw("editor.face."+Ew[m]),Iw(Ew[m],"visible",!0),hteditor.setter("s",d)),f.addRow(w,[this.indent,.1])}C(S,dw("editor.visible"),f),f.validateImpl(),P=Math.max(P,f.getScrollHeight()),f=new ht.widget.FormPane;for(var m=0;m<Ew.length;m++){var E=Ew[m]+".reverse.color";w=[],this.addLabelColor(w,dw("editor.face."+Ew[m]),Iw(Ew[m],"reverse.color"),hteditor.setter("s",E)),f.addRow(w,[this.indent,.1])}C(S,dw("editor.reversecolor"),f),f.validateImpl(),P=Math.max(P,f.getScrollHeight()),f=new ht.widget.FormPane;for(var m=0;m<Ew.length;m++){var I=Ew[m]+".reverse.flip";w=[],this.addLabelCheckBox(w,dw("editor.face."+Ew[m]),Iw(Ew[m],"reverse.flip",!0),hteditor.setter("s",I)),f.addRow(w,[this.indent,.1])}C(S,dw("editor.reverseflip"),f),f.validateImpl(),P=Math.max(P,f.getScrollHeight()),f=new ht.widget.FormPane;for(var m=0;m<Ew.length;m++){var c=Ew[m]+".reverse.cull";w=[],this.addLabelCheckBox(w,dw("editor.face."+Ew[m]),Iw(Ew[m],"reverse.cull",!0),hteditor.setter("s",c)),f.addRow(w,[this.indent,.1])}C(S,dw("editor.reversecull"),f),f.validateImpl(),P=Math.max(P,f.getScrollHeight());var a=S.getTabHeight()+P;w=[],w.push(S),this.addRow(w,[.1],a)},f}(pw),Nw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"Cone"))}return a(f,w),f}(pw),xw=hteditor.getString,Ww=["shape3d","shape3d.top","shape3d.bottom","shape3d.from","shape3d.to"],yw=["shape3d","shape3d.top","shape3d.bottom"],$w=function(w){return function(f){var P=f.s(w);return P?P[0]:1}},kw=function(w){return function(f,P){var S=f.s(w);f.s(w,[P,S?S[1]:1])}},uw=function(w){return function(f){var P=f.s(w);return P?P[1]:1}},_w=function(w){return function(f,P){var S=f.s(w);f.s(w,[S?S[0]:1,P])}},Vw=function(w){return function(f){f.s(w,null)}},lw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"Shape3d"))}return a(f,w),f.prototype.initForm=function(){w.prototype.initForm.call(this),this.addEffectProperties(),this.addTopBodyBottomProperties()},f.prototype.getCurrentPoint=function(w){return this.editor.currentPoint?this.editor.currentPoint[w]:0},f.prototype.setCurrentPoint=function(w,f){this.editor.gv.getEditInteractor().getSubModule("Curve").setCurrentPoint(w,f)},f.prototype.addTopBodyBottomProperties=function(){var w=void 0,f=void 0,P=0,S=new ht.widget.TabView,m=this.faces;f=new ht.widget.FormPane;for(var D=0;D<m.length;D++){var Q=m[D]+".image";w=[],this.addLabelImage(w,xw("editor.face."+m[D]),hteditor.getter("s",Q),hteditor.setter("s",Q)),f.addRow(w,[this.indent,.1,20])}C(S,xw("editor.image"),f,!0),f.validateImpl(),P=Math.max(P,f.getScrollHeight()),f=new ht.widget.FormPane;for(var D=0;D<m.length;D++){var B=m[D]+".uv.scale";w=[],this.addLabel(w,xw("editor.face."+m[D])),this.addButton(w,null,xw("editor.reset"),"editor.resetsize.state",Vw(B)),this.addLabelInput(w,"U",$w(B),kw(B),"number",1),this.addLabelInput(w,"V",uw(B),_w(B),"number",1),f.addRow(w,[this.indent-20-8,20,20,.1,20,.1])}C(S,xw("editor.repeat"),f,!0),f.validateImpl(),P=Math.max(P,f.getScrollHeight()),f=new ht.widget.FormPane;for(var D=0;D<m.length;D++){var p=m[D]+".color";w=[],this.addLabelColor(w,xw("editor.face."+m[D]),hteditor.getter("s",p),hteditor.setter("s",p)),f.addRow(w,[this.indent,.1,20])}C(S,xw("editor.color"),f),f.validateImpl(),P=Math.max(P,f.getScrollHeight()),f=new ht.widget.FormPane;for(var D=0;D<m.length;D++){var d=m[D]+".visible";w=[],this.addLabelCheckBox(w,xw("editor.face."+m[D]),hteditor.getter("s",d),hteditor.setter("s",d)),f.addRow(w,[this.indent,.1,20])}C(S,xw("editor.visible"),f),f.validateImpl(),P=Math.max(P,f.getScrollHeight()),f=new ht.widget.FormPane,w=[],this.addLabelColor(w,xw("editor.color"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),f.addRow(w,[this.indent,.1]),w=[],this.addLabelCheckBox(w,xw("editor.flip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),f.addRow(w,[this.indent,.1]),w=[],this.addLabelCheckBox(w,xw("editor.cull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),f.addRow(w,[this.indent,.1]),C(S,xw("editor.reverse"),f),f.validateImpl(),P=Math.max(P,f.getScrollHeight());var E=S.getTabHeight()+P;w=[],w.push(S),this.addRow(w,[.1],E)},f.prototype.addEffectProperties=function(){this.addTitle(xw("editor.titleeffect"));var w=[];this.addLabelCheckBox(w,xw("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(w,[this.indent,.1]),w=[],this.addLabelColor(w,xw("editor.blend"),hteditor.getter("s","shape3d.blend"),hteditor.setter("s","shape3d.blend")),this.addRow(w,[this.indent,.1]),w=[],this.addLabelRange(w,xw("editor.opacity"),hteditor.getter("s","shape3d.opacity"),hteditor.setter("s","shape3d.opacity"),0,1,.01,"number"),this.addRow(w,[this.indent,.1]),w=[],this.addLabelRange(w,xw("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),0,void 0,1,"int"),this.addRow(w,[this.indent,.1]),this.simple||(w=[],this.addLabelRange(w,xw("editor.side.from"),hteditor.getter("s","shape3d.side.from"),hteditor.setter("s","shape3d.side.from"),0,void 0,1,"int"),this.addRow(w,[this.indent,.1]),w=[],this.addLabelRange(w,xw("editor.side.to"),hteditor.getter("s","shape3d.side.to"),hteditor.setter("s","shape3d.side.to"),0,void 0,1,"int"),this.addRow(w,[this.indent,.1]))},f.prototype.addExtraProperties=function(w){},c(f,[{key:"simple",get:function(){return!1}},{key:"faces",get:function(){return this.simple?yw:Ww}}]),f}(pw),gw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"Cylinder"))}return a(f,w),f}(lw),Fw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"RoundRect"))}return a(f,w),f}(pw),Rw=["shape3d","shape3d.from","shape3d.to"],iw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"Sphere"))}return a(f,w),c(f,[{key:"faces",get:function(){return Rw}}]),f}(lw),hw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"Torus"))}return a(f,w),f}(pw),qw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"Triangle"))}return a(f,w),f}(pw),zw=hteditor.getString,Jw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"Model"))}return a(f,w),f.prototype.$12$=function(){w.prototype.$12$.call(this);var f=[];f=[],this.addLabelCheckBox(f,zw("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(f,[this.indent,.1]),f=[],this.addLabelColor(f,zw("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addRow(f,[this.indent,.1]),f=[],this.addLabelColor(f,zw("editor.blend"),hteditor.getter("s","shape3d.blend"),hteditor.setter("s","shape3d.blend")),this.addRow(f,[this.indent,.1]),f=[],this.addLabelRange(f,zw("editor.opacity"),hteditor.getter("s","shape3d.opacity"),hteditor.setter("s","shape3d.opacity"),0,1,.01,"number"),this.addRow(f,[this.indent,.1]),f=[],this.addLabelCheckBox(f,zw("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addRow(f,[this.indent,.1])},f}(pw),Xw=hteditor.getString,vw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"Billboard"))}return a(f,w),f.prototype.$12$=function(){var f=this;w.prototype.$12$.call(this),this.addTitle(Xw("editor.titlepanel"));var P=[];this.addLabelImage(P,Xw("editor.image"),function(w){return w.s("shape3d.image")},function(w,f){w.s("shape3d.image",f)}),this.addOneRow(P),P=[],this.addLabelInput(P,Xw("editor.texturescale"),function(w){return w.s("shape3d.texture.scale")||1},hteditor.setter("s","shape3d.texture.scale"),"number");P[P.length-1];this.addOneRow(P),P=[],this.addLabelCheckBox(P,Xw("editor.alwaysontop"),hteditor.getter("s","shape3d.alwaysOnTop"),hteditor.setter("s","shape3d.alwaysOnTop")),this.addLabelCheckBox(P,Xw("editor.transparent"),hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(P,[this.indent,.1,this.indent2,.1]),P=[],this.addLabelCheckBox(P,Xw("editor.autorotate"),hteditor.getter("s","shape3d.autorotate"),hteditor.setter("s","shape3d.autorotate"));var S=P[P.length-1];this.addLabelCheckBox(P,Xw("editor.cache"),hteditor.getter("s","shape3d.image.cache"),function(w,P){w.s("shape3d.image.cache",P),P&&f.editor.scene.invalidateShape3dCachedImage(w)}),this.addRow(P,[this.indent,.1,this.indent2,.1]),P=[],this.addLabelCheckBox(P,Xw("editor.fitsize"),function(w){return!!w.s("shape3d.fixSizeOnScreen")},function(w,f){w.s("shape3d.fixSizeOnScreen",!!f&&[-1,-1]),f&&w.s("shape3d.autorotate",!0),S.setDisabled(f),m.setDisabled(f)}),this.addLabelCheckBox(P,Xw("editor.dynamic"),hteditor.getter("s","shape3d.vector.dynamic"),hteditor.setter("s","shape3d.vector.dynamic"));var m=P[P.length-1];this.addRow(P,[this.indent,.1,this.indent2,.1]),P=[],this.addLabelColor(P,Xw("editor.color"),hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addRow(P,[this.indent,.1]),P=[],this.addLabelColor(P,Xw("editor.reversecolor"),hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),this.addRow(P,[this.indent,.1]),P=[],this.addLabelCheckBox(P,Xw("editor.reversecull"),hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addLabelCheckBox(P,Xw("editor.reverseflip"),hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),this.addRow(P,[this.indent,.1,this.indent2,.1])},f}(pw),Uw=hteditor.getString,Aw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"Wall"))}return a(f,w),f.prototype.$12$=function(){w.prototype.$12$.call(this);var f=[];this.addLabelCheckBox(f,Uw("editor.closepath"),hteditor.getter("p","closePath"),hteditor.setter("p","closePath")),this.addRow(f,[this.indent,.1])},f.prototype.addTransformProperties=function(){w.prototype.addTransformProperties.call(this);var f=[];this.addLabelRange(f,Uw("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(f,Uw("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1,"number"),this.addLabelRange(f,Uw("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(f,[this.indent,.1,30,.1,30,.1])},f}(Tw),rw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"Floor"))}return a(f,w),f}(gw),nw=hteditor.getString,Mw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"Pipeline"))}return a(f,w),f.prototype.addTransformProperties=function(){w.prototype.addTransformProperties.call(this);var f=[];this.addLabelRange(f,nw("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(f,nw("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1),this.addLabelRange(f,nw("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(f,[this.indent,.1,30,.1,30,.1])},f.prototype.addExtraProperties=function(f){w.prototype.addExtraProperties.call(this);var P=[];this.addLabelInput(P,nw("editor.startangle"),function(w){return Math.round(180/Math.PI*w.s("shape3d.start.angle"))},function(w,f){w.s("shape3d.start.angle",f*Math.PI/180)},"int",1),f.addRow(P,[this.indent,.1]),P=[],this.addLabelInput(P,nw("editor.sweepangle"),function(w){return Math.round(180/Math.PI*w.s("shape3d.sweep.angle"))},function(w,f){w.s("shape3d.sweep.angle",f*Math.PI/180)},"int",1),f.addRow(P,[this.indent,.1])},c(f,[{key:"simple",get:function(){return!0}}]),f}(lw),Lw=hteditor.getString,Gw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"Polyline"))}return a(f,w),f.prototype.addTransformProperties=function(){var f=this;w.prototype.addTransformProperties.call(this);var P=[];this.addLabelRange(P,Lw("editor.uvlength"),hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(P,Lw("editor.thickness"),hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1),this.addLabelRange(P,Lw("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(P,[this.indent,.1,30,.1,30,.1]),P=[],P.push(Lw("editor.point")),this.addButton(P,null,Lw("editor.reset"),"editor.resetsize.state",function(w){f.setCurrentPoint("e",0)}),this.addLabelInput(P,"X",function(w){return f.getCurrentPoint("x")},function(w,P){f.setCurrentPoint("x",P)},"int",1),this.addLabelInput(P,"Y",function(w){return f.getCurrentPoint("e")},function(w,P){f.setCurrentPoint("e",P)},"int",1),this.addLabelInput(P,"Z",function(w){return f.getCurrentPoint("y")},function(w,P){f.setCurrentPoint("y",P)},"int",1),this.addRow(P,[this.indent-40-8,20,20,.1,20,.1,20,.1])},c(f,[{key:"simple",get:function(){return!0}}]),f}(lw),Hw=hteditor.getString,Kw=function(w){return function(f){var P=f.s(w);return P?P[0]:1}},Ow=function(w){return function(f,P){var S=f.s(w);f.s(w,[P,S?S[1]:1])}},Zw=function(w){return function(f){var P=f.s(w);return P?P[1]:1}},Yw=function(w){return function(f,P){var S=f.s(w);f.s(w,[S?S[0]:1,P])}},tw=function(w){return function(f){f.s(w,null)}},jw=function(w){function f(P){return I(this,f),o(this,w.call(this,P,"Edge"))}return a(f,w),f.prototype.initForm=function(){w.prototype.initForm.call(this),this.$89$(),this.$91$(),this.addEdgeSourceNodeProperties(),this.addEdgeTargetNodeProperties()},f.prototype.$12$=function(){var w=this;this.addTitle(Hw("editor.titlebasic"));var f=[];this.addLabelInput(f,Hw("editor.name"),hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(f,Hw("editor.tag"),hteditor.getter("p","tag"),hteditor.setter("p","tag")),this.addRow(f,[this.indent,.1,this.indent2,.1]),f=[],this.addLabelURL(f,Hw("editor.navigate"),function(w){return w.a("navigate")||""},function(w,f){w.a("navigate",f)},function(w,f){var P=f.view.draggingData;return P&&("scene"===P.fileType||"display"===P.fileType)}),this.addLabelInput(f,Hw("editor.tooltip"),hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(f,[this.indent,.1,this.indent2,.1]),f=[],this.addLabelComboBoxURL(f,Hw("editor.type"),function(w){return w.s("shape3d")},function(f,P){f.s("shape3d",P),w.editor.updateInspector()},["","cylinder"],void 0,void 0,function(w,f){return!!f.view.draggingData&&"model"===f.view.draggingData.fileType}),this.addImage(f,function(w){return w.s("shape3d")},void 0,function(w){return hteditor.isJSON(w)?w.substr(0,w.length-5)+".png":null},function(w){return hteditor.isJSON(w.rawIcon)}),this.addOneRow(f),f=[],this.addLabelCheckBox(f,Hw("editor.selectable"),function(w){return w.s("3d.selectable")},function(w,f){w.s("2d.selectable",f),w.s("3d.selectable",f)}),this.addLabelCheckBox(f,Hw("editor.movable"),function(w){return w.s("3d.movable")},function(w,f){w.s("2d.movable",f),w.s("3d.movable",f)}),this.addRow(f,[this.indent,.1,this.indent2,.1]),f=[],this.addLabelCheckBox(f,Hw("editor.editable"),function(w){return w.s("3d.editable")},function(w,f){w.s("2d.editable",f),w.s("3d.editable",f)}),this.addLabelCheckBox(f,Hw("editor.visible"),function(w){return w.s("3d.visible")},function(w,f){w.s("2d.visible",f),w.s("3d.visible",f)}),this.addRow(f,[this.indent,.1,this.indent2,.1]),f=[],this.addLabelCheckBox(f,Hw("editor.interactive"),function(w){return w.s("interactive")},function(w,f){return w.s("interactive",f)}),this.addRow(f,[this.indent,.1]),f=[],this.addLabelRange(f,Hw("editor.envmap"),function(w){return w.s("envmap")||0},hteditor.setter("s","envmap"),0,1,.01,"number"),this.addRow(f,[this.indent,.1]),f=[],this.addLabelRange(f,Hw("editor.brightness"),function(w){return w.s("select.brightness")},hteditor.setter("s","select.brightness"),0,1,.01,"number"),this.addRow(f,[this.indent,.1]),f=[],this.addLabelObject(f,Hw("editor.polygonoffset"),function(w){return w.s("polygonOffset")},hteditor.setter("s","polygonOffset"),"number"),this.addRow(f,[this.indent,.1])},f.prototype.addTransformProperties=function(){},f.prototype.$89$=function(){this.addTitle("TitleEdgeBasic");var w=[];this.addLabelComboBox(w,Hw("editor.type"),hteditor.getter("s","edge.type"),hteditor.setter("s","edge.type"),[void 0,"points"]),this.addRow(w,[this.indent,.1]),w=[],this.addLabelInput(w,Hw("editor.width"),hteditor.getter("s","edge.width"),hteditor.setter("s","edge.width"),"number",1),this.addLabelInput(w,Hw("editor.offset"),hteditor.getter("s","edge.offset"),hteditor.setter("s","edge.offset"),"number",1),this.addRow(w,[this.indent,.1,this.indent2,.1]),w=[],this.addLabelInput(w,Hw("editor.side"),hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),"number",1),this.addLabelInput(w,Hw("editor.resolution"),hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),"number",1),this.addRow(w,[this.indent,.1,this.indent2,.1]),w=[],this.addLabelColor(w,Hw("editor.color"),hteditor.getter("s","edge.color"),hteditor.setter("s","edge.color")),this.addLabelCheckBox(w,Hw("editor.center"),hteditor.getter("s","edge.center"),hteditor.setter("s","edge.center")),this.addRow(w,[this.indent,.1,this.indent2,.1]),w=[],this.addLabelImage(w,Hw("editor.image"),hteditor.getter("s","shape3d.image"),hteditor.setter("s","shape3d.image")),this.addRow(w,[this.indent,.1,20]),w=[],this.addLabel(w,"UV"),this.addButton(w,null,Hw("editor.reset"),"editor.resetsize.state",tw("shape3d.uv.scale")),this.addLabelInput(w,"U",Kw("shape3d.uv.scale"),Ow("shape3d.uv.scale"),"number",1),this.addLabelInput(w,"V",Zw("shape3d.uv.scale"),Yw("shape3d.uv.scale"),"number",1),this.addRow(w,[this.indent-20-8,20,20,.1,20,.1]),w=[],this.addLabel(w,"UV "+Hw("editor.offset")),this.addButton(w,null,Hw("editor.reset"),"editor.resetsize.state",tw("shape3d.uv.offset")),this.addLabelInput(w,"U",function(w){return(w.s("shape3d.uv.offset")||[0,0])[0]},function(w,f){var P=w.s("shape3d.uv.offset")||[];w.s("shape3d.uv.offset",[f,P[1]])},"number",.1),this.addLabelInput(w,"V",function(w){return(w.s("shape3d.uv.offset")||[0,0])[1]},function(w,f){var P=w.s("shape3d.uv.offset")||[];w.s("shape3d.uv.offset",[P[0],f])},"number",.1),this.addRow(w,[this.indent-20-8,20,20,.1,20,.1])},f.prototype.$91$=function(){},f.prototype.addEdgeSourceNodeProperties=function(){var w=d.config.numberPrecision;this.addTitle("editor.titleedgesourcenode");var f=[];this.addLabelData(f,Hw("editor.node"),hteditor.getter("p","source"),function(w,f){w instanceof ht.Edge&&(null==f||f instanceof ht.Node||f instanceof ht.Edge)&&(w.setSource(f),w.s("edge.source.percent",.5))}),this.addRow(f,[this.indent,.1,20]);var P=w.anchor||0,S=0===P?"int":"number",m=1/Math.pow(10,P);f=[],f.push(Hw("editor.anchor")),this.addButton(f,null,Hw("editor.reset"),"editor.resetsize.state",function(w){w instanceof ht.Edge&&w.s({"edge.source.anchor.x":.5,"edge.source.anchor.elevation":.5,"edge.source.anchor.y":.5})}),this.addLabelInput(f,"X",function(w){var f=w.s("edge.source.anchor.x");return null==f&&(f=.5),Number(f.toFixed(P))},function(w,f){w instanceof ht.Edge&&w.s("edge.source.anchor.x",parseFloat(f))},S,m),this.addLabelInput(f,"Y",function(w){var f=w.s("edge.source.anchor.elevation");return null==f&&(f=.5),Number(f.toFixed(P))},function(w,f){w instanceof ht.Edge&&w.s("edge.source.anchor.elevation",parseFloat(f))},S,m),this.addLabelInput(f,"Z",function(w){var f=w.s("edge.source.anchor.y");return null==f&&(f=.5),Number(f.toFixed(P))},function(w,f){w instanceof ht.Edge&&w.s("edge.source.anchor.y",parseFloat(f))},S,m),this.addRow(f,[this.indent-40-8,20,20,.1,20,.1,20,.1])},f.prototype.addEdgeTargetNodeProperties=function(){var w=d.config.numberPrecision;this.addTitle("editor.titleedgetargetnode");var f=[];this.addLabelData(f,Hw("editor.node"),hteditor.getter("p","target"),function(w,f){w instanceof ht.Edge&&(null==f||f instanceof ht.Node||f instanceof ht.Edge)&&(w.setTarget(f),w.s("edge.target.percent",.5))}),this.addRow(f,[this.indent,.1,20]);var P=w.anchor||0,S=0===P?"int":"number",m=1/Math.pow(10,P);f=[],f.push(Hw("editor.anchor")),this.addButton(f,null,Hw("editor.reset"),"editor.resetsize.state",function(w){w instanceof ht.Edge&&w.s({"edge.target.anchor.x":.5,"edge.target.anchor.elevation":.5,"edge.target.anchor.y":.5})}),this.addLabelInput(f,"X",function(w){var f=w.s("edge.target.anchor.x");return null==f&&(f=.5),Number(f.toFixed(P))},function(w,f){w instanceof ht.Edge&&w.s("edge.target.anchor.x",parseFloat(f))},S,m),this.addLabelInput(f,"Y",function(w){var f=w.s("edge.target.anchor.elevation");return null==f&&(f=.5),Number(f.toFixed(P))},function(w,f){w instanceof ht.Edge&&w.s("edge.target.anchor.elevation",parseFloat(f))},S,m),this.addLabelInput(f,"Z",function(w){var f=w.s("edge.target.anchor.y");return null==f&&(f=.5),Number(f.toFixed(P))},function(w,f){w instanceof ht.Edge&&w.s("edge.target.anchor.y",parseFloat(f))},S,m),this.addRow(f,[this.indent-40-8,20,20,.1,20,.1,20,.1])},f}(pw),bw=hteditor.getString,wf=function(w){function f(P){I(this,f);var S=o(this,w.call(this));S.editor=P;var m=[];return m.push({label:bw("editor.ok"),action:function(){S.ok()}}),m.push({label:bw("editor.cancel"),action:function(){S.hide()}}),S.dm=new ht.DataModel,S.node=new ht.Node,S.node.s("wf.visible",!0),S.node.setAnchor3d(.5,0,.5),S.dm.add(S.node),S.g3d=new ht.graph3d.Graph3dView(S.dm),S.g3d.setGridVisible(!0),S.formPane=S.createFromPane(),S.splitView=new ht.widget.SplitView(S.g3d,S.formPane,"h",.55),S.setConfig({title:bw("editor.objsetting"),closable:!0,draggable:!0,width:666,height:500,contentPadding:0,resizeMode:"wh",maximizable:!0,content:S.splitView,buttons:m,buttonsAlign:"right"}),S.setModal(!1),S}return a(f,w),f.prototype.toJSON=function(){var w={modelType:"obj"};return w.obj=this.formPane.v("obj"),w.mtl=this.formPane.v("mtl"),w.image=this.formPane.v("imageURL"),w.prefix=this.formPane.v("prefix"),w.center=this.formPane.v("center"),this.formPane.v("reverseFlipMtls")&&(w.reverseFlipMtls="*"),w.ignoreImage=!!this.formPane.v("ignoreImage"),w.ignoreColor=!!this.formPane.v("ignoreColor"),w.s3=[Number(this.formPane.v("sX")),Number(this.formPane.v("sY")),Number(this.formPane.v("sZ"))],w.r3=[Number(this.formPane.v("rX")),Number(this.formPane.v("rY")),Number(this.formPane.v("rZ"))],w},f.prototype.ok=function(){var w=this,f=this.formPane.v("url");if(f){this.json=this.toJSON();var P={path:f,content:ht.Default.stringify(this.json)};this.editor.request("upload",P,function(S){P={path:f.substr(0,f.length-5)+".png",content:w.g3d.toDataURL(w.dm.getBackground())},w.editor.request("upload",P,function(f){w.hide()})})}},f.prototype.open=function(w,f){this.url=w,this.json=f,this.node.s("shape3d",w),this.node.p3(0,0,0),this.g3d.reset(),this.update(),this.isShowing()||this.show()},f.prototype.update=function(){var w=this.json;if(this.url){this.formPane.getViewById("url").setEditable(!1),this.formPane.v("url",this.url);var f=ht.Default.getShape3dModel(this.url);if(f&&f.rawS3){var P=f.rawS3[0],S=f.rawS3[1],m=f.rawS3[2],D=Math.max(S,P/(this.g3d.getAspect()||1)),Q=D/2/Math.tan(this.g3d.getFovy()/2);Q=2*Math.max(m/2,Q),this.g3d.setEye(0,S/2,Q),this.g3d.setCenter(0,S/2,0),this.g3d.setNear(Math.min(10,Q/4)),this.g3d.setFar(Math.max(1e4,4*Q)),w=this.json=ht.Default.parse(ht.Default.stringify(f.json))}}else this.formPane.getViewById("url").setEditable(!0),this.formPane.v("url",this.editor.models.currentDir+"/***.json");w||(w={obj:"",mtl:"",imageURL:"",prefix:"",center:!0,s3:[1,1,1],r3:[0,0,0],image:null}),this.formPane.v("obj",w.obj||""),this.formPane.v("mtl",w.mtl||""),this.formPane.v("imageURL",w.image||""),this.formPane.v("prefix",w.prefix||""),this.formPane.v("reverseFlipMtls",!!w.reverseFlipMtls),this.formPane.v("center",!!w.center);var B=w.s3||[1,1,1];this.formPane.v("sX",B[0]),this.formPane.v("sY",B[1]),this.formPane.v("sZ",B[2]);var C=w.r3||[0,0,0];this.formPane.v("rX",C[0]),this.formPane.v("rY",C[1]),this.formPane.v("rZ",C[2]),this.formPane.getItemById("image").element.setIcon(w.image)},f.prototype.createFromPane=function(){var w=this,f=new ht.widget.FormPane;f.addRow([{element:bw("editor.url")},{id:"url",textField:{}}],[60,.1]),f.addRow([{element:"obj"},{id:"obj",textField:{handleChange:function(){var P=S.value,m=P.lastIndexOf("/")+1,D=P.substr(0,P.length-4).substr(m);f.v("prefix")||f.v("prefix",P.substr(0,m)),f.v("mtl")||f.v("mtl",P.substr(0,P.length-3)+"mtl");var Q=f.v("url"),B=void 0;Q&&(B=Q.lastIndexOf("***.json"))>=0&&f.v("url",Q.substr(0,B)+D+".json"),w.updateModel()}}}],[60,.1]);var P=f.getViewById("obj"),S=P.getElement();P.isDroppable=function(w,f){return!!f.view.draggingData&&m(f.view.draggingData.getFileUUID())},P.handleCrossDrag=function(w,f,m){"enter"===f?S.style.border="solid "+d.config.color_select_dark+" 2px":"exit"===f||"cancel"===f?S.style.border="":"over"===f||"drop"===f&&(S.style.border="",S.value=m.view.draggingData.getFileUUID(),P.setFocus(),P.handleChange())},f.addRow([{element:"mtl"},{id:"mtl",textField:{handleChange:function(){var P=B.value,S=P.lastIndexOf("/")+1,m=P.substr(0,P.length-4).substr(S);f.v("prefix")||f.v("prefix",P.substr(0,S)),f.v("obj")||f.v("obj",P.substr(0,P.length-3)+"obj");var D=f.v("url"),Q=void 0;D&&(Q=D.lastIndexOf("***.json"))>=0&&f.v("url",D.substr(0,Q)+m+".json"),w.updateModel()}}}],[60,.1]);var Q=f.getViewById("mtl"),B=Q.getElement();Q.isDroppable=function(w,f){return!!f.view.draggingData&&D(f.view.draggingData.getFileUUID())},Q.handleCrossDrag=function(w,f,P){"enter"===f?B.style.border="solid "+d.config.color_select_dark+" 2px":"exit"===f||"cancel"===f?B.style.border="":"over"===f||"drop"===f&&(B.style.border="",B.value=P.view.draggingData.getFileUUID(),Q.setFocus(),Q.handleChange())},f.addRow([{element:bw("editor.imageprefix")},{id:"prefix",textField:{}}],[60,.1]),f.addRow([{element:bw("editor.reverseFlipMtls")},{id:"reverseFlipMtls",checkBox:{onClicked:function(){w.updateModel()}}},{element:bw("editor.modelcenter"),align:"right"},{id:"center",checkBox:{onClicked:function(){w.updateModel()}}}],[60,.1,60,.1]),f.addRow([{element:bw("editor.modelignoreImage")},{id:"ignoreImage",checkBox:{onClicked:function(){w.updateModel()}}},{element:bw("editor.modelignoreColor"),align:"right"},{id:"ignoreColor",checkBox:{onClicked:function(){w.updateModel()}}}],[60,.1,60,.1]),f.addRow([],[.1],1.01,{background:"#E4E4E4"}),f.addRow([null,"X","Y","Z"],[60,.1,.1,.1]),f.addRow([bw("editor.scale"),{id:"sX",textField:{type:"number"}},{id:"sY",textField:{type:"number"}},{id:"sZ",textField:{type:"number"}}],[60,.1,.1,.1]);var C=d.config.numberPrecision,p=C.rotation||0;f.addRow([bw("editor.rotation"),{id:"rX",textField:{getValue:function(){return Number(this.getText())/180*Math.PI},setValue:function(w){this.setText((w/Math.PI*180).toFixed(p))},type:"number"}},{id:"rY",textField:{getValue:function(){return Number(this.getText())/180*Math.PI},setValue:function(w){this.setText((w/Math.PI*180).toFixed(p))},type:"number"}},{id:"rZ",textField:{getValue:function(){return Number(this.getText())/180*Math.PI},setValue:function(w){this.setText((w/Math.PI*180).toFixed(p))},type:"number"}}],[60,.1,.1,.1]),["s","r"].forEach(function(P){["X","Y","Z"].forEach(function(S){var m=f.getViewById(P+S).getElement();m.onblur=function(){return w.updateModel()},m.onkeydown=function(f){ht.Default.isEnter(f)&&w.updateModel()}})}),f.addRow([],[.1],1.01,{background:"#E4E4E4"}),f.addRow([{element:bw("editor.image")},{id:"imageURL",textField:{}
}],[60,.1]),f.addRow([{id:"image",image:{}}],[.1],70);var E=f.getViewById("imageURL").getElement();return E.onblur=function(f){w.formPane.getItemById("image").element.setIcon(E.value)},E.onkeydown=function(f){ht.Default.isEnter(f)&&w.formPane.getItemById("image").element.setIcon(E.value)},f},f.prototype.updateModel=function(){var w=this.toJSON(),f=JSON.stringify(w);this._currentJSON!==f&&(this.node.s("shape3d",w),this._currentJSON=f)},f}(ht.widget.Dialog),ff=hteditor.getString,Pf=function(){function m(w){var f=this;I(this,m),this.params=w,this._eventNotifier=new ht.Notifier,this._clones=[],this.modelDialogs={},this.$39$=w.$39$;var P=ht.Default.getClass(hteditor.config.serviceClass||s);this.$40$=new P(this.handleServiceEvent.bind(this),this),ht.Default.handleModelLoaded=function(w,P){for(var S in f.modelDialogs){var m=f.modelDialogs[S];w===m.url&&m.isShowing()&&m.update&&m.update()}f.inspector&&f.inspector.updateProperties()},this.serializer=new ht.JSONSerializer,this.serializer.isSerializable=function(w){return f.scene.sm().contains(w)},this.editable=!0}return m.prototype.addEventListener=function(){hteditor.Editor.prototype.addEventListener.apply(this,arguments)},m.prototype.removeEventListener=function(w,f){hteditor.Editor.prototype.removeEventListener.apply(this,arguments)},m.prototype.fireEvent=function(w,f){hteditor.Editor.prototype.fireEvent.apply(this,arguments)},m.prototype.handleServiceEvent=function(m){if("connected"===m.type)this.init&&(this.init(),this.init=null);else if("fileChanged"===m.type){var D=m.path;B(D)&&(this.scene.invalidateAll(),this.gv.invalidateAll()),w(D)?this.requestScenes():f(D)?(this.requestModels(),this.scene.invalidateAll(),this.gv.invalidateAll()):P(D)?this.requestSymbols():S(D)&&this.requestAssets()}else"download"===m.type?this.downloadFile(m.path):"confirm"===m.type&&this.requestImport(m.path);this.fireEvent(m.type,m)},m.prototype.downloadFile=function(w){hteditor.Editor.prototype.downloadFile.apply(this,arguments)},m.prototype.requestImport=function(w){hteditor.Editor.prototype.requestImport.apply(this,arguments)},m.prototype.beginTransaction=function(){this.dm.beginTransaction()},m.prototype.endTransaction=function(){this.dm.endTransaction()},m.prototype.toggleGridEnabled=function(){this.gridVisible=!this.gridVisible},m.prototype.init=function(){var w=this;this.menus=[],this.dm=new ht.DataModel,this.gv=new q(this),this.rulerView=new h(this.gv),this.scene=new R(this),this.functionView=new hteditor.FunctionView(this),this.fontView=new hteditor.FontView(this),this.objectView=new hteditor.ObjectView(this),this.sceneInspector=new Bw(this),this.dataInspector=new pw(this),this.cubeInspector=new Tw(this),this.coneInspector=new Nw(this),this.cylinderInspector=new gw(this),this.roundRectInspector=new Fw(this),this.sphereInspector=new iw(this),this.torusInspector=new hw(this),this.triangleInspector=new qw(this),this.modelInspector=new Jw(this),this.billboardInspector=new vw(this),this.wallInspector=new Aw(this),this.floorInspector=new rw(this),this.pipelineInspector=new Mw(this),this.polylineInspector=new Gw(this),this.edgeInspector=new jw(this),this.mainToolbar=new l(this),this.fireEvent("mainToolbarCreated"),this.rightToolbar=new F(this),this.fireEvent("rightToolbarCreated"),this.topBorderPane=new ht.widget.BorderPane,this.topBorderPane.setCenterView(this.mainToolbar),this.topBorderPane.setRightView(this.rightToolbar),this.topBorderPane.setHeight(28),this.rightToolbar.onSumWidthChanged=function(){w.topBorderPane.setRightWidth(w.rightToolbar.getSumWidth())},this.$5$("edit"),this.mainTabView=new ht.widget.TabView,this.scenes=new e(this),this.models=new T(this),this.symbols=new N(this),this.assets=new x(this),this.leftTopTabView=new ht.widget.TabView,C(this.leftTopTabView,ff("editor.scenes"),this.scenes,!0),C(this.leftTopTabView,ff("editor.models"),this.models),C(this.leftTopTabView,ff("editor.symbols"),this.symbols),C(this.leftTopTabView,ff("editor.assets"),this.assets),this.treeView=new A(this),this.jsonView=new r(this),this.rightBottomTabView=new ht.widget.TabView,C(this.rightBottomTabView,ff("editor.list"),this.treeView,!0),C(this.rightBottomTabView,ff("editor.data"),this.jsonView);var f=this.rightBottomTabView.getTabModel().sm();f.ms(function(){var P=f.ld();w.jsonView.visible=(P?P.getView():null)===w.jsonView}),this.alignPane=new M(this),this.rightTopBorderPane=new ht.widget.BorderPane,this.rightTopBorderPane.setTopView(this.alignPane),this.rightTopBorderPane.setCenterView(this.inspectorPane),this.rightTopBorderPane.setTopHeight(ht.Default.widgetHeaderHeight+6),this.centerSplitView=new ht.widget.SplitView(this.rulerView,this.scene,"v"),this.leftSplitView=new ht.widget.SplitView(this.leftTopTabView,this.centerSplitView,"h",260),this.rightSplitView=new ht.widget.SplitView(this.rightTopBorderPane,this.rightBottomTabView,"v",-300),this.mainSplitView=new ht.widget.SplitView(this.leftSplitView,this.rightSplitView,"h",-360),this.mainPane=new ht.widget.BorderPane,this.mainPane.setTopView(this.topBorderPane),this.mainPane.setCenterView(this.mainSplitView),hteditor.layoutMainView(this.mainPane,this.$39$),this.$39$&&this.$39$.addEventListener("keydown",this.handleKeydown.bind(this),!1),this.dnd=new hteditor.DND(this),this.dndFromOutside=new hteditor.DNDFromOutside(this,this.$39$),this.requestScenes(),this.requestModels(),this.requestSymbols(),this.requestAssets(),this.reset(),this.dm.addDataModelChangeListener(this.handleDataModelChange,this),this.dm.addPropertyChangeListener(this.handleDataModelPropertyChange,this),this.dm.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this.sm.ms(this.handleSelectionChange,this),this.scene.addPropertyChangeListener(this.handleScenelPropertyChange,this),this.gv.addInteractorListener(this.handleInteractor,this),this.updateInspector(),this.fireEvent("editor3dCreated"),this.dm.enableHistoryManager(hteditor.config.maxUndoRedoSteps),this.initSID();var P=this.params.open||p("hteditor")||hteditor.config.open;P&&(hteditor.isJSON(P)?this._pendingOpenJSON=P:"newscene"===P&&this.newScene())},m.prototype.initSID=function(){var w=window.location.href.match("sid=([0-9a-z-]*)");w&&(this.sid=w[1])},m.prototype.handleDataModelPropertyChange=function(w){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.jsonView.$67$()},m.prototype.handleScenelPropertyChange=function(w){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.jsonView.$67$()},m.prototype.handleDataModelChange=function(w){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.jsonView.$67$()},m.prototype.handleDataPropertyChange=function(w){var f=w.data;if("parent"===w.property&&f instanceof ht.Node&&!ht.Default.isIsolating()){var P=f.getParent();(!P||P instanceof ht.Node&&!(P instanceof ht.Block))&&f.setHost(P)}this.inspector&&!this.inspector.global&&this.inspector.data===f&&this.inspector.updateProperties(),this.jsonView.$67$()},m.prototype.handleSelectionChange=function(){this.updateInspector()},m.prototype.handleInteractor=function(w){"selectPoint"===w.kind&&(this.currentPoint=void 0===w.x?null:{x:w.x,y:w.y,e:w.e},this.updateInspector())},m.prototype.updateInspector=function(){this.inspector=null;var w=this.ld;if(w){var f=w.s("shape3d");w instanceof ht.Polyline?this.inspector=this.polylineInspector:w instanceof ht.Shape?"cylinder"===f?this.inspector=this.pipelineInspector:w.getThickness()>0?this.inspector=this.wallInspector:this.inspector=this.floorInspector:w instanceof ht.Node?f?hteditor.isJSON(f)?this.inspector=this.modelInspector:"billboard"===f||"plane"===f?this.inspector=this.billboardInspector:"cube"===f?this.inspector=this.cubeInspector:"cone"===f?this.inspector=this.coneInspector:"cylinder"===f?this.inspector=this.cylinderInspector:"roundRect"===f?this.inspector=this.roundRectInspector:"sphere"===f?this.inspector=this.sphereInspector:"torus"===f?this.inspector=this.torusInspector:"triangle"===f&&(this.inspector=this.triangleInspector):this.inspector=this.cubeInspector:w instanceof ht.Edge&&(this.inspector=this.edgeInspector),this.inspector||(this.inspector=this.dataInspector)}else this.inspector=this.sceneInspector;this.inspector&&(this.inspector.data=w,this.inspector.updateProperties()),this.rightTopBorderPane.setCenterView(this.inspector)},m.prototype.reset=function(w){w||(this.url=null),this.dm.disableHistoryManager(),this.scene.setCenter([0,0,0]),this.scene.setEye([0,300,1e3]),this.scene.enablePostProcessing("Bloom",!1),this.scene.enablePostProcessing("Dof",!1),this.gridVisible=!0,this.dm.setName(void 0),this.dm.setBackground(void 0),this.dm.setHierarchicalRendering(!0),this.dm.setLayers(void 0),this.dm.setAttrObject(void 0),this.dm.setEnvmap(void 0),this.dm.clear(),this.editInteractor.setStyle("gridBlockSize",50),this.editInteractor.setStyle("gridThickLinesEvery",hteditor.config.displayGridThickLinesEvery),this.editInteractor.setStyle("gridThickColor",hteditor.config.displayGridThickColor),this.editInteractor.setStyle("gridLightColor",hteditor.config.displayGridLightColor),this.editInteractor.setStyle("gridAngle",hteditor.config.displayGridAngle),this.editInteractor.setStyle("gridRotation",hteditor.config.displayGridRotation),this.editInteractor.setStyle("gridZoomThreshold",.02),this.dm.enableHistoryManager(),this.dm.clearHistoryManager()},m.prototype.getModelDialog=function(w){var f=this.modelDialogs[w];if(!f){var P=hteditor.config.modelDialogClasses?hteditor.config.modelDialogClasses[w]:null;P||(P=wf),f=this.modelDialogs[w]=new P(this)}return f},m.prototype.open=function(w,f){var P=this;if(ht.Default.isString(w)&&(w=this.getFileNode(w)),w&&!w.$34$){var S=w.url;"scene"===w.fileType?this.newScene(S):"model"===w.fileType&&ht.Default.xhrLoad(S,function(w){w=ht.Default.parse(w),P.getModelDialog(w.modelType).open(S,w)})}},m.prototype.newOBJModel=function(){this.getModelDialog("obj").open()},m.prototype.newScene=function(w){w?(this.opened=!1,this.url=w,this.reload()):(this.reset(),this.fireEvent("sceneViewCreated",{sceneView:this}))},m.prototype.reload=function(){var w=this,f=this.url;f&&(this.fireEvent(this.opened?"SceneViewReloading":"SceneViewOpening",{sceneView:this,url:f}),this.reset(!0),this.dm.disableHistoryManager(),this.scene.deserialize(f,{finishFunc:function(P,S){w.gv.fitContent(!0);var m=P.scene;w.scene.setEye(m.eye),w.scene.setCenter(m.center),w.scene.setFar(m.far),w.scene.setNear(m.near),w.gridVisible=!!m.gridVisible,w.scene.setGridColor(m.gridColor),w.scene.setGridGap(m.gridGap),w.scene.setGridSize(m.gridSize),w.scene.setEditHelperDisabled(!!m.editHelperDisabled),w.rightToolbar.iv(),w.dm.enableHistoryManager(),w.dm.clearHistoryManager(),w.fireEvent(w.opened?"SceneViewReloaded":"SceneViewOpened",{sceneView:w,url:f}),w.opened=!0},disableOnPreDeserialize:!0,disableOnPostDeserialize:!0}))},m.prototype.save=function(){var w=this;if(this.url)this.saveImpl(this.url);else{var f=this.scenes.currentDir,P=ff("editor.inputnewscenename"),S=function(P,S){if("ok"===S){var m=hteditor.isJSON(P)?hteditor.trimExtension(P):P,D=f+"/"+m+".json",Q=!1;if(w.scenes.dataModel.each(function(w){w.url===D&&(Q=!0)}),Q){var B=[{label:ff("editor.ok"),action:function(){C.hide()}}],C=new ht.widget.Dialog({title:ff("editor.filenameconflict"),contentPadding:20,width:300,draggable:!0,content:"<p>"+D+"</p>",buttons:B});C.show()}else w.saveImpl(D)}},m={name:void 0,scene:this.scene};this.fireEvent("sceneNewNameInputing",m),m.name?S(m.name,"ok"):hteditor.getInput(P,"",{nullable:!1,trim:!0,maxLength:hteditor.config.maxFileNameLength},S)}},m.prototype.saveImpl=function(w){var f=this;if(w){this.url=w;var P={url:w,scene:this.scene};if(this.fireEvent("sceneSaving",P),P.preventDefault)return!1;P={path:P.url,content:this.serialize()},this.request("upload",P,function(S){!0===S&&(f.fireEvent("sceneSaved",P),P={path:w.substr(0,w.length-5)+".png",content:f.scene.toImage(f.dm.getBackground())},f.request("upload",P))})}},m.prototype.preview=function(){var w=this.dm.a("previewURL")||"scene.html";this.url&&-1===w.indexOf("?")&&(w+="?tag="+encodeURI(this.url));var f={url:w};this.fireEvent("sceneViewPreviewing",f),window.open(f.url,f.url),f={path:"previews/scene.json",content:this.serialize()},this.request("upload",f,function(w){})},m.prototype.deserialize=function(w){var f=this;this.scene.deserialize(w,function(w,P,S){var m=w.scene;m&&(m.eye&&f.scene.setEye(m.eye),m.center&&f.scene.setCenter(m.center),m.near&&f.scene.setNear(m.near),m.far&&f.scene.setFar(m.far),m.background&&f.dm.setBackground(m.background),m.gridSize&&f.scene.setGridSize(m.gridSize),m.gridGap&&f.scene.setGridGap(m.gridGap),m.gridColor&&f.scene.setGridColor(m.gridColor))})},m.prototype.serialize=function(){return ht.Default.stringify(this.toJSON())},m.prototype.toJSON=function(){var w=this.dm.toJSON();return w.scene={eye:this.scene.getEye(),center:this.scene.getCenter(),near:this.scene.getNear(),far:this.scene.getFar(),background:this.dm.getBackground(),gridVisible:this.gridVisible,gridSize:this.scene.getGridSize(),gridGap:this.scene.getGridGap(),gridColor:this.scene.getGridColor(),editHelperDisabled:this.scene.isEditHelperDisabled()},w},m.prototype.$4$=function(){return this._interactionState},m.prototype.$5$=function(w,f){var P=this;if(this._interactionState!==w){this._interactionState=w,this.pointsEditingMode=!1;var S=[];this.gv.getInteractors().each(function(f){f.keep?f.interactiveDisabled="edit"!==w:S.push(f)}),S.forEach(function(w){w.tearDown(),P.gv.getInteractors().remove(w)}),"edit"!==w&&(f.setUp(),this.gv.getInteractors().add(f)),this.gv.invalidateSelection(),this.rulerView.validateCanvas(),this.mainToolbar.iv()}},m.prototype.request=function(w,f,P,S){var m=this;P=P||E,S?setTimeout(function(){m.$40$.request(w,f,P)},S):this.$40$.request(w,f,P)},m.prototype.requestScenes=function(){var f=this;this._requestingScenes||(this.request("explore","/scenes",function(P){f._requestingScenes=!1,f.scenes.parse(P),f._pendingOpenJSON&&w(f._pendingOpenJSON)&&(f.scenes.dataModel.getDataById(f._pendingOpenJSON)?(f.open(f._pendingOpenJSON),f.selectFileNode(f._pendingOpenJSON)):d.config.newIfFailToOpen&&(f.newScene(),f.url=f._pendingOpenJSON,f.save()),delete f._pendingOpenJSON)},hteditor.config.requestDelay),this._requestingScenes=!0)},m.prototype.requestSymbols=function(){var w=this;this._requestingSymbols||(this.request("explore","/symbols",function(f){w._requestingSymbols=!1,w.symbols.parse(f)},hteditor.config.requestDelay),this._requestingSymbols=!0)},m.prototype.requestModels=function(){var w=this;this._requestingModels||(this.request("explore","/models",function(f){w._requestingModels=!1,w.models.parse(f)},hteditor.config.requestDelay),this._requestingModels=!0)},m.prototype.requestAssets=function(){var w=this;this._requestingAssets||(this.request("explore","/assets",function(f){w._requestingAssets=!1,w.assets.parse(f)},hteditor.config.requestDelay),this._requestingAssets=!0)},m.prototype.requestBase64=function(w,f){this.request("source",{url:w,encoding:"base64",prefix:"data:;base64,"},f)},m.prototype.copy=function(){if(this.ld){this.serializer.dm=this.scene.dm();var w=this.serializer.toJSON();delete w.p,delete w.a,this._cloneJSON=ht.Default.stringify(w)}},m.prototype.paste=function(){if(this._cloneJSON){var w=this.serializer.deserialize(this._cloneJSON);this.scene.sm().ss(w)}},m.prototype.undo=function(){hteditor.Editor.prototype.undo.apply(this,arguments)},m.prototype.redo=function(){hteditor.Editor.prototype.redo.apply(this,arguments)},m.prototype.renameFile=function(){hteditor.Editor.prototype.renameFile.apply(this,arguments)},m.prototype.getFileNode=function(){return hteditor.Editor.prototype.getFileNode.apply(this,arguments)},m.prototype.moveFile=function(){hteditor.Editor.prototype.moveFile.apply(this,arguments)},m.prototype.removeFiles=function(){hteditor.Editor.prototype.removeFiles.apply(this,arguments)},m.prototype.locate=function(){hteditor.Editor.prototype.locate.apply(this,arguments)},m.prototype.newFolder=function(){hteditor.Editor.prototype.newFolder.apply(this,arguments)},m.prototype.toggleLeft=function(){"normal"===this.leftSplitView.getStatus()?this.leftSplitView.setStatus("cl"):this.leftSplitView.setStatus("normal")},m.prototype.toggleRight=function(){"normal"===this.mainSplitView.getStatus()?this.mainSplitView.setStatus("cr"):this.mainSplitView.setStatus("normal")},m.prototype.handleKeydown=function(w){try{hteditor.Editor.prototype.handleKeydown.apply(this,arguments)}catch(w){return}var f=w.keyCode,P=ht.Default.isCtrlDown(w),S=ht.Default.isShiftDown(w);if(90===f){if(!P&&!S){var m=this.dm.sm().getSelection();0===m.length&&(m=null),this.zoomToFit(m)}}else if(71===f&&P){if(S){var D=this.dm.sm().ld();if(!D||!D.s("__group__"))return;this.beginTransaction();var Q=D.getChildren().toArray();return Q.forEach(function(w){w.setParent(null),w.setHost(null)}),this.dm.remove(D),this.dm.sm().ss(Q),void this.endTransaction()}if(0===this.dm.sm().size())return;var B=this.scene.getBoundingBox(),C=B.min,p=B.max,d=p[0]-C[0],E=p[2]-C[2],I=p[1]-C[1];this.beginTransaction();var c=new ht.Node;c.s3(d,I,E),c.p3(C[0]+.5*d,C[1]+.5*I,C[2]+.5*E),c.s({shape3d:"box","shape3d.transparent":!0,"shape3d.color":"rgba(0, 0, 0, 0)","shape3d.reverse.cull":!0,__group__:!0}),this.dm.add(c);var m=this.dm.sm().getSelection();m.forEach(function(w){w.setParent(c),w.setHost(c)}),this.dm.sm().ss(c),this.endTransaction()}},m.prototype.selectFileNode=function(w){hteditor.Editor.prototype.selectFileNode.apply(this,arguments)},m.prototype.dropLocalFileOnDir=function(w,f){hteditor.Editor.prototype.dropLocalFileOnDir.apply(this,arguments)},m.prototype.uploadLocalFile=function(w,f){hteditor.Editor.prototype.uploadLocalFile.apply(this,arguments)},m.prototype.zoomToFit=function(w){this.scene.flyTo(w,{animation:!0});var f=this.gv;if(!w)return void f.fitContent(!0);var P;w.each(function(w){P=ht.Default.unionRect(P,f.getDataUIBounds(w))}),ht.Default.grow(P,20,20),f.fitRect(P,!0)},c(m,[{key:"url",get:function(){return this._url},set:function(w){this._url=w,this.jsonView.updateUrl()}},{key:"ld",get:function(){return this.sm.ld()}},{key:"sm",get:function(){return this.dm.sm()}},{key:"editInteractor",get:function(){return this.gv.getEditInteractor()}},{key:"pointsEditingMode",get:function(){return this.editInteractor.pointsEditingMode},set:function(w){this.editInteractor.pointsEditingMode=w}},{key:"anchorVisible",get:function(){return this.editInteractor.getStyle("anchorVisible")},set:function(w){this.editInteractor.setStyle("anchorVisible",w)}},{key:"gridVisible",get:function(){return this.scene.isGridVisible()},set:function(w){this.scene.setGridVisible(w),this.scene.setOriginAxisVisible(w),this.editInteractor.gridEnabled=w}},{key:"explorer",get:function(){return this.leftTopTabView.getCurrentTab().getView()}}]),m}();return d.version="0.3.1",d.createEditor3d=function(w){if(window.location.host.indexOf("hightopo")>=0){var f="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cdiv style='display:none'%3E%3Cspan id='cnzz_stat_icon_1000279011'%3E%3C/span%3E%3Cscript src='"+f+"s23.cnzz.com/z_stat.php%3Fid%3D1000279011%26show%3Dpic' type='text/javascript'%3E%3C/script%3E%3C/div%3E")),document.body.style.margin="0px",document.body.style.padding="0px"}w&&(ht.Default.isString(w)?w={container:w}:w.tagName&&w.appendChild&&(w={container:w})),w=w||{};var P=void 0,S=void 0===w.container?d.config.container:w.container;return null===S?P=null:S?ht.Default.isString(S)?P=document.getElementById(S):S.length?(P=ht.Default.createDiv(),P.style.left=S[0]+"px",P.style.top=S[1]+"px",P.style.width=S[2]+"px",P.style.height=S[3]+"px",document.body.appendChild(P)):P=S:P=document.body,w.$39$=P,new Pf(w)},d.config.valueTypes||(d.config.valueTypes={}),d.config.valueTypes.HighlightEnum={type:"enum",values:[0,1,2],i18nLabels:["editor.none","editor.selected","editor.hover"]},d}();