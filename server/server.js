!function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var n=r(1),i=r(2),o=r(4),a=r(48),s=r(25),c=r(51),u=r(14),l=n.join(n.normalize(__dirname),"/"),f=n.join(l,"config.ini"),p=i(f);global.globalConfig=p.global,p.global&&p.global.locale&&u.setLanguage(p.global.locale);var g=r(16);process.on("uncaughtException",function(e){"ECONNRESET"!=e.code&&"EPIPE"!=e.code&&e.host!==c.hostName&&g.error("Caught exception: ",e)});for(var d in p)if("global"!==d){var h=p[d],v=new o({port:h.port,autoOpen:h.autoOpen,is3D:h.is3D,name:d,customDir:s.toAbsolute(h.customDir,l),clientDir:s.toAbsolute(h.clientDir,l),storageDir:s.toAbsolute(h.storageDir,l),storagePrefix:h.storagePrefix,urlPrefix:h.urlPrefix});v.start(),global[d]=v}p.global.repl&&a.on(),c.send()},function(e,t){e.exports=require("path")},function(e,t,r){function n(e){return'"'===e.charAt(0)&&'"'===e.slice(-1)||"'"===e.charAt(0)&&"'"===e.slice(-1)}function i(e){e=(e||"").trim(),n(e)&&(e=e.substr(1,e.length-2));try{e=JSON.parse(e)}catch(e){}return e}var o=r(3);e.exports=function(e){var t,r,n=o.readFileSync(e,"utf-8"),a=/^\[([^\]]*)\]$|^([^=]+)(=(.*))?$/i,s={};s.global={};for(var c=n.split(/[\r\n]+/g),u=0;u<c.length;u++){var l=c[u];if(l&&!l.match(/^\s*[;#]/)){var f=l.match(a);if(f)if(void 0===f[1]){var p=i(f[2]),g=!f[3]||i(f[4]);"true"===g?g=!0:"false"===g?g=!1:"null"===g&&(g=null),r[p]=g}else t=i(f[1]),r=s[t]=s[t]||{}}}return s}},function(e,t){e.exports=require("fs")},function(e,t,r){function n(e){this.init(e)}var i=r(5),o=r(6),a=r(7),s=r(46),c=r(16),u=r(31),l=r(37),f=r(14);i.inherits(n,o.EventEmitter),n.prototype.init=function(e){var t=this.name=e.name+" >> "+e.port;this.config=e,o.EventEmitter.call(this),c.trace("[{0}] "+f("preInit"),t),this.emit(this.state="preInit");var r=e.urlPrefix;r?(r=r.replace(/(^\s*\/*|\/*\s*$)/g,""),r=e.urlPrefix=r.length?r+"/":""):r=e.urlPrefix="",this.net=new a(this,e.port,{customDir:e.customDir,clientDir:e.clientDir,storageDir:e.storageDir,storagePrefix:e.storagePrefix,urlPrefix:e.urlPrefix}),this.watcher=new s(this,e),c.trace("[{0}] "+f("postInit"),t),this.emit(this.state="postInit")},n.prototype.start=function(){if(c.trace("[{0}] "+f("startServer"),this.name),this.net.start(),this.watcher.start(),this.emit(this.state="booted"),this.config.autoOpen&&!process.versions.electron){var e=global.globalConfig.enableHttps?"https":"http",t=e+"://localhost:"+this.config.port+"/"+this.config.urlPrefix;u(global.globalConfig&&global.globalConfig.auth?t+"index.html?sid="+l.genSID():this.config.is3D?t+"index3d.html":t)}},n.prototype.stop=function(){c.trace("[{0}] "+f("stopServer"),this.name),this.emit(this.state="preDestruct"),this.net.stop(),this.watcher.stop(),this.emit(this.state="postDestruct")},e.exports=n},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("events")},function(e,t,r){function n(e,t,r){this.init(e,t,r)}var i=r(8),o=r(9),a=r(10),s=r(11),c=r(12),u=r(1),l=r(3),f=r(13),p=r(14),g=r(16),d=r(18),h=r(37),v=r(22),m=r(42),x=r(43),b=r(45);n.prototype.init=function(e,t,r){this.server=e,this.port=t,this.conf=r},n.prototype.start=function(e,t){var r=this,n=i(),y=r.conf,S=global.globalConfig.sslKey,D=global.globalConfig.sslCert,w=global.globalConfig.sslPfx,j=global.globalConfig.sslPassphrase,E=null;if(S&&D?E={key:l.readFileSync(S),cert:l.readFileSync(D),passphrase:j}:w&&(E={pfx:l.readFileSync(w),passphrase:j}),global.globalConfig.enableHttps&&null!=E)var P=b.createServer(E,n);else{var P=o.Server(n);global.globalConfig.enableHttps=!1}var C=a(P);g.trace("[{0}] "+p("startNetService"),r.server.name),n.use(s({filter:function(e,t){return!0}})),n.use(c()),n.get(/^\/.*.zip/,function(e,t,r){var n=u.join(y.storageDir,decodeURI(e.path)),i=l.statSync(n);t.set({"Content-Type":"application/octet-stream","Content-Disposition":"attachment; filename="+encodeURI(u.basename(n)),"Content-Length":i.size});var o=l.createReadStream(n);o.pipe(t),o.on("close",function(){f.sync(u.dirname(n))})}),h.routine(n),n.use(m.urlencoded({extended:!0})),x(n,y);var O="/"+y.urlPrefix;n.use(O,i.static(y.clientDir)),n.use(O+"help",i.static(u.join(y.clientDir,"../help"))),n.use(O+"custom",i.static(y.customDir)),n.use(O,i.static(u.join(y.customDir,"previews"))),n.use(O+y.storagePrefix,i.static(y.storageDir)),n.use(/\/explore($|\/.*)/,function(e,t){var r=e.baseUrl.match(/\/explore($|\/.*)/),n=y.storageDir;r[1]&&(n=u.join(n,r[1]));try{var i=v.explore(n);t.send(JSON.stringify(i))}catch(e){t.send("Failed")}}),P.listen(r.port,function(){e&&e(t),r.server.emit("serviceOn",{server:r})}),C.on("connection",function(e){g.trace("[{0}] "+p("newConnection"),r.server.name),e.on("disconnect",function(){g.trace("[{0}] "+p("disconnect"),r.server.name)}),d.registerCommand(e),e.server=r.server,r.server.emit("newConnection",e)}),r.server.on("fileChanged",function(e,t){r.broadcast("fileChanged",{event:t,path:e})}),r.http=P,r.io=C},n.prototype.stop=function(e,t){this.http.close(function(){e&&e(t)})},n.prototype.broadcast=function(e,t){this.io.emit(e,t)},e.exports=n},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("rimraf")},function(e,t,r){var n=r(15),i="en";e.exports=function(e){return n[e]?n[e][i]||e:e},e.exports.setLanguage=function(e){i=e}},function(e,t){e.exports={exitRepl:{en:"(To exit, press ^C again or type .exit)",zh:"（如果要退出，请再次按 ^C 或者执行 .exit）"},preInit:{en:"Pre-initialization",zh:"开始初始化"},postInit:{en:"Post-initialization",zh:"结束初始化"},startServer:{en:"Start server",zh:"启动服务"},stopServer:{en:"Stop server",zh:"停止服务"},startNetService:{en:"Start network service",zh:"启动网络服务"},newConnection:{en:"New connection",zh:"新连接"},disconnect:{en:"Disconnect",zh:"断开连接"},PING:{en:"PING: Test connection",zh:"PING: 测试链路"},EXPLORE:{en:"EXPLORE: Fetch directories and files",zh:"EXPLORE: 获取目录和文件"},MKDIR:{en:"MKDIR: Create a directory",zh:"MKDIR: 创建目录"},UPLOAD:{en:"UPLOAD: Upload to save file",zh:"UPLOAD: 上传保存文件"},RENAME:{en:"RENAME: Rename a directory or file",zh:"RENAME: 重命名目录或文件"},REMOVE:{en:"REMOVE: Remove a directory or file",zh:"REMOVE: 删除目录或文件"},OPEN:{en:"OPEN: Open file",zh:"OPEN: 打开文件"},LOCATE:{en:"LOCATE: Locate a directory or file",zh:"LOCATE: 定位目录或文件"},SAVE_IMAGE:{en:"SAVE_IMAGE: Save image file",zh:"SAVE_IMAGE: 保存图片文件"},SOURCE:{en:"SOURCE: Fetch the content of a file",zh:"SOURCE: 获取文件内容"}}},function(e,t,r){var n=r(17),i=r(5);n.configure({appenders:[{type:"console",category:"console",layout:{type:"messagePassThrough"}}]});var o={white:["[37m","[39m"],grey:["[90m","[39m"],black:["[30m","[39m"],blue:["[34m","[39m"],cyan:["[36m","[39m"],green:["[32m","[39m"],magenta:["[35m","[39m"],red:["[31m","[39m"],yellow:["[33m","[39m"]},a=function(e){var t=e[0];return e.length<=1?i.format(t):t.replace(/\{(\d+)\}/g,function(t,r){return i.format(e[parseInt(r)+1])})},s=!0,c=!1;e.exports={enableTrace:s,enableDebug:c,trace:function(){if(s){var e=a(arguments),t=n.getLogger("console");t.info(e)}},important:function(){var e=a(arguments),t=n.getLogger("console");t.info(o.green[0]+e+o.green[1])},error:function(){var e=a(arguments),t=n.getLogger("console");t.error(o.red[0]+e+o.red[1]);for(var r=1;r<arguments.length;r++)arguments[r]&&arguments[r].stack&&t.error(arguments[r].stack)},debug:function(){if(c){var e=a(arguments),t=n.getLogger("console");t.info(e)}}}},function(e,t){e.exports=require("log4js")},function(e,t,r){var n=r(19),i=r(16),o=r(37),a=r(14),s={},c=function(e,t){e.on(t,function(r,n,i){u(e,t,r,n,i)})},u=function(){var e,t,r,c,u,l=arguments,p=0;"string"!=typeof l[0]&&(e=l[p++]),t=l[p++],r=l[p++],c=l[p++],u=l[p++],global.globalConfig&&global.globalConfig.auth&&("object"==typeof u&&o.authSID(u.sid)||f(e,"operationDone",r,"Unauthorized agent"));var g=n[t];try{s[t]||i.trace("----- {0} ----",a(t));var d=g.call(g,e,r,c,function(t){r>=0&&e&&void 0!==t&&f(e,"operationDone",r,t)});r>=0&&e&&void 0!==d&&f(e,"operationDone",r,d)}catch(e){i.error("cmd : {0}, exception : {1}",t,e)}},l=function(e){for(var t in n)c(e,t)},f=function(e,t,r,n){e&&e.emit(t,r,n)},p=function(e,t){t?delete s[e]:s[e]=!0};e.exports={registerCommand:l,executeCommand:u,sendMessage:f,enableTrace:p}},function(e,t,r){e.exports={ping:r(20),explore:r(21),mkdir:r(26),upload:r(27),rename:r(28),remove:r(29),open:r(30),locate:r(33),source:r(35),auth:r(36),refreshSID:r(39),export:r(40),import:r(41)}},function(e,t){e.exports=function(e,t,r){return r}},function(e,t,r){var n=r(22);e.exports=function(e,t,r){var i=n.getFullPath(e,r);return n.explore(i)}},function(e,t,r){function n(e){if(e=e.toLowerCase(),/(__$|^\.|\.swap$|\.out$|\.svn$|^\~\$|\~$)/.test(C.basename(e)))return!0}function i(e){var t={},r=P.readdirSync(e);return r.forEach(function(r){if(!n(r))try{var o=C.join(e,r),a=P.statSync(o);a.isDirectory()?t[r]=i(o):t[r]=!0}catch(e){}}),t}function o(e,t){var r=R&~process.umask();e=C.resolve(e),t||(make=null);try{P.mkdirSync(e,r),t=t||e}catch(r){switch(r.code){case"ENOENT":t=o(C.dirname(e),t),o(e,t);break;default:var n;try{n=P.statSync(e)}catch(e){throw e}if(!n.isDirectory())throw r}}return t}function a(e,t){var r=e.server.config.storageDir;return t?C.join(r,t):r}function s(e){return e=F.toUnixPath(e),e=e.replace(/(^\/*|\/*$)/g,""),["displays","symbols","assets","scenes","models","previews","components"].indexOf(e)>=0}function c(e){return/.*\.html$/.test(e)}function u(e){return/.*\.mtl$/.test(e)}function l(e){return/.*\.json$/.test(e)}function f(e){return/.*\.js$/i.test(e)}function p(e){return/.*\.obj$/i.test(e)}function g(e){return q.test(e)}function d(e,t,r,n){var i,o,a,s,h=e.storageDir,v=e.customDir,m=C.join(h,"models"),x=global.globalConfig.exportWithJS;if(null==x&&(x=!1),c(t)){if(o=C.join(v,"previews",t),s={},s.path=o,s.fileName=C.basename(n,".json")+".html",s.graph=n.substring(h.length+1),r.indexOf(s)>-1)return}else if(o=C.join(h,t),r.indexOf(o)>-1)return;try{i=P.readFileSync(o)}catch(e){}if(i){if(s)r.push(s);else{if(r.push(o),l(t)&&(a=o.substring(0,o.lastIndexOf("."))+".png",r.push(a)),g(t))return;if(p(t))return}i=i.toString().trim();var b=[];if(b=u(t)?w(i):j(i),c(t))b.forEach(function(t){try{k.test(t)?(t=t.replace(/\.\//g,""),"previews/display.json"!==t&&d(e,t,r)):x&&f(t)&&(r.indexOf(t)>-1?"":r.push(t))}catch(e){}});else{if(l(o)&&o.indexOf(m)>-1){var y=JSON.parse(i);E=y.prefix||""}b.forEach(function(n){u(t)&&(n=C.join(E,n)),d(e,n,r,o)})}}}function h(e,t,r){var n=e.storageDir,i=e.clientDir,o=e.customDir,a=C.dirname(o),s=O("zip",{zlib:{level:9}});s.pipe(r),t.length>0&&t.forEach(function(e){var t,r;if("object"==typeof e){var o=e.fileName;r=e.graph.replace(/\\/g,"/"),e=e.path,t=C.join("storage",o)}else/.*\.js$/.test(e)?(t=e,e=/custom\/.*\/.*/.test(e)?C.join(a,e):C.join(i,e)):(t=e.substring(e.lastIndexOf(n)+n.length+1),t=C.join("storage",t));try{var u=P.readFileSync(e);c(e)&&(u=u.toString(),u=u.replace(/src="/g,"src='"),u=u.replace(/\.js">/g,".js'>"),u=u.replace(/'custom\//g,"'../custom/"),u=u.replace(/'libs\//g,"'../libs/"),u=u.replace("GetQueryString('tag')","'"+r+"'"),u=u.replace("previews/display.json",r),u=u.replace("previews/symbol.json",r)),s.append(u,{name:t})}catch(e){}}),s.finalize()}function v(e){return/^displays\/.*/.test(e)?"display-export.html":/^symbols\/.*/.test(e)?"symbol-export.html":null}function m(e){return/^displays\/.*/.test(e)||/^symbols\/.*/.test(e)}function x(e,t){var r,n=[],i=e.customDir,o=0;"string"==typeof t&&(t=[t]);var a=0;return t.forEach(function(t){var s,c=C.basename(t,".json"),c=c.replace(/%/g,""),u=[],l=C.extname(t);if(""!==l){if(d(e,t,u),r=c,o++,u.forEach(function(e){"object"==typeof e?s=e:void 0!==e&&(n.indexOf(e)>-1||n.push(e))}),!m(t))return;var f=v(t);if(!s){var p=[];0===a?(d(e,f,p,t),p.forEach(function(e){"object"==typeof e?(s=e,s.graph=t):void 0!==e&&(n.indexOf(e)>-1||n.push(e))}),a++):(s={},s.path=C.join(i,"previews",f),s.fileName=C.basename(t,".json")+".html",s.graph=t)}s&&(n.indexOf(s)>-1||n.push(s))}}),o>1&&(r+="(+"+o+")"),{zipFileName:r,paths:n}}function b(e,t,r,n,i){var o=[],a=P.readdirSync(r);return a.forEach(function(a){s(a)&&(n=!0,i=C.join(r,a));try{var c=C.join(r,a),u=P.statSync(c);if(u.isDirectory())o=o.concat(b(e,t,c,n,i));else if(n){var l=c.substring(i.lastIndexOf("storage")+8);o.push(C.join(e,l))}}catch(e){}}),o}function y(e,t,r){var n=b(e,t,r);if(0!=n.length){var i=[];return n.forEach(function(e){P.existsSync(e)&&i.push(e)}),i}}function S(e,t,r,n,i){var a=P.readdirSync(r);a.forEach(function(a){s(a)&&(n=!0,i=C.join(r,a));try{var u=C.join(r,a),l=P.statSync(u);if(l.isDirectory())S(e,t,u,n,i);else if(n&&!c(a)){var f=u.substring(i.lastIndexOf("storage")+8);f=C.join(e,f),P.existsSync(C.dirname(f))===!1&&o(C.dirname(f)),P.writeFileSync(f,P.readFileSync(u))}}catch(e){}})}function D(e,t,r){var n=e.storageDir,i=e.customDir,a="/temp/",s=String((new Date).getTime()),c=t.substring(t.lastIndexOf("/")+1),u=C.join(n,a,c),l=C.join(n,a,s),f=z.sync.unzip(r).memory();f.contents().forEach(function(e){var t=f.read(e,"buffer"),r=C.join(l,e);P.existsSync(C.dirname(r))===!1&&o(C.dirname(r)),P.writeFileSync(r,t)}),I.sync(u);var p=y(n,i,l);if(p){if(0!=p.length)return{tempName:s,paths:p};S(n,i,l),I.sync(l)}else;return null}function w(e){var t=[],r=e.match(L);return r&&r.forEach(function(e){e=e.substring(e.lastIndexOf(" ")),t.push(e.trim())}),t}function j(e){var t=[],r=e.match($);if(r)r.forEach(function(e){var r=e.split(/('|")/);1===r.length?t.push(r):r.forEach(function(e){t=t.concat(j(e))})});else{var n="";n=e.length>100?e.substring(e.length-20,e.length):e,A.test(n)&&t.push(e)}return t}var E,P=r(3),C=r(1),O=r(23),z=r(24),I=r(13),F=r(25),R=parseInt("0777",8),_="png|jpg|gif|jpeg|bmp",q=new RegExp(".*\\.("+_+")","i"),N=_+"|json|html|obj|mtl",k=new RegExp(".*\\.("+N+")","i"),L=new RegExp("\\s.*\\.(".concat(_).concat(")"),"ig"),$=new RegExp("(\"|').*\\.(".concat(N).concat("|").concat("js").concat(")"),"ig"),A=new RegExp(".*\\.(".concat(N).concat("|").concat("js").concat(")$"),"ig");e.exports={isHidden:n,explore:i,ensureDirSync:o,getFullPath:a,isPredefined:s,exportSource:x,importZip:D,moveSourceFile:S,createZip:h}},function(e,t){e.exports=require("archiver")},function(e,t){e.exports=require("zip-local")},function(e,t,r){var n=r(1);e.exports.toUnixPath=function(e){e=e.replace(/\\/g,"/");for(var t=/\/\//;e.match(t);)e=e.replace(t,"/");return e},e.exports.toAbsolute=function(e,t){return n.isAbsolute(e)||(e=n.join(t,"/",e)),e}},function(e,t,r){var n=r(22);e.exports=function(e,t,r){if(r=r.trim()){var i=n.getFullPath(e,r),o=n.ensureDirSync(i);return"string"==typeof o}}},function(e,t,r){var n=r(3),i=r(1),o=r(22),a=/^\s*data:([a-z]+\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,/i,s=/\.zip$/i;e.exports=function(e,t,r){var c=r.content,u=o.getFullPath(e,r.path);if(a.test(c)&&(c=c.replace(a,""),c=new Buffer(c,"base64")),s.test(u)){var l=o.importZip(e.server.config,u,c);l&&e.emit("confirm",l.tempName,l.paths)}else o.ensureDirSync(i.dirname(u)),n.writeFileSync(u,c);return!0}},function(e,t,r){var n=r(3),i=r(22),o=r(16);e.exports=function(e,t,r){var a=i.getFullPath(e,r.old),s=i.getFullPath(e,r.new),c=function(e){return o.trace(e),!1};if(!n.existsSync(a))return c(a+" does not exist");if(i.isPredefined(r.old))return c("Source is predefined, cannot be renamed");if(i.isPredefined(r.new))return c("Target is predefined, cannot be renamed");try{n.renameSync(a,s)}catch(e){return c("Rename failed, detail: "+e)}return!0}},function(e,t,r){var n=r(3),i=r(13),o=r(22);e.exports=function(e,t,r){var a=o.getFullPath(e,r);return!n.existsSync(a)||!o.isPredefined(r)&&(i.sync(a),!0)}},function(e,t,r){var n=r(22),i=r(31);e.exports=function(e,t,r){const o=n.getFullPath(e,r);return i("file:"+o),o}},function(e,t,r){var n=r(32);e.exports=function(e,t,r){var i="win32"===process.platform?"cmd":"darwin"===process.platform?"open":"xdg-open";return"string"==typeof e&&(e=[e]),"function"==typeof t&&(r=t,t={}),t&&"object"==typeof t&&t.command&&("win32"===process.platform?e=[t.command].concat(e):i=t.command),"win32"===process.platform&&(e=e.map(function(e){return e.replace(/&/g,"^&")}),e=["/c","start",'""'].concat(e)),n.execFile(i,e,t,r)}},function(e,t){e.exports=require("child_process")},function(e,t,r){var n=r(22),i=r(34);e.exports=function(e,t,r){const o=n.getFullPath(e,r);return i(o),!0}},function(e,t,r){var n=r(32);e.exports=function(e,t){var r,i="win32"===process.platform?"explorer":"darwin"===process.platform?"open":"xdg-open";return"win32"===process.platform?(i="explorer",e=e.replace(/ /g,"%20"),r=["/e,/select,file:"+e]):"darwin"===process.platform?(i="open",r=["-a","finder",e,"-R"]):(i="xdg-open",r=[e]),n.execFile(i,r,void 0,t)}},function(e,t,r){var n=r(22),i=r(3);e.exports=function(e,t,r){var o,a=r.url||r,s=n.getFullPath(e,a);try{o=i.readFileSync(s)}catch(e){}if(!o)return"";var c;return c=o?r.encoding?new Buffer(o).toString(r.encoding):/\.(png|jpg|gif|jpeg|bmp)$/i.test(s)?new Buffer(o).toString("base64"):new Buffer(o).toString():"",r.prefix&&(c=r.prefix+c),c}},function(e,t,r){var n=r(37);e.exports=function(e,t,r){return!!n.authSID(r)}},function(e,t,r){var n=r(38).v4,i={},o=6e5,a=0,s=3e4,c=function(){l();var e=n();return i[e]={time:Date.now()},e},u=function(e){var t=i[e];if(!t)return!1;var r=t.time,n=Date.now(),a=global.globalConfig.sessionExpireTime||o;return n-r>a?(delete i[e],!1):(t.time=n,!0)},l=function(){var e=Date.now(),t=e-a;if(!(t<s)){a=e;for(var r=Object.keys(i),n=0,c=r.length;n<c;n++){var u=r[n],l=i[u].time;e-l>o&&delete i[u]}}},f=function(e){e.status(404).send("Not Found.")},p=function(e){var t=e.baseUrl;if(t.endsWith(".js"))return!0;var r=e.query;if(!r)return!1;var n=r.sid;return!!n&&u(n)},g=function(e){if("::1"===e)return!0;var t=e.match(/\d+\.\d+\.\d+\.\d+/);if(!t)return!1;if(e=t[0],"127.0.0.1"===e)return!0;var r=global.globalConfig;if(!r)return!1;var n=r.SIDServiceWhiteList;if(!n)return!1;var i=r.SIDServiceWhiteListParsed;if(!i){for(var o="",a=n.split(","),s=[],c=0,u=a.length;c<u;c++){var l=a[c].trim();l&&s.push(l.replace(/\./g,"\\.").replace(/\*/g,"[\\d\\.]*"))}o=s.length?1===s.length?s[0]:"("+s.join("|")+")":"HTISAWESOM",i=r.SIDServiceWhiteListParsed=new RegExp("^"+o+"$")}return i.test(e)},d=function(e,t){var r=e.baseUrl,n=global.globalConfig?global.globalConfig.SIDRequestService:null;if(r===n||r==="/"+n)return g(e.ip)?t.send(c()):f(t),!0},h=function(e){global.globalConfig&&global.globalConfig.auth&&e.use("*",function(e,t,r){if(/(^\/vs\/.*)/.test(e.baseUrl))return void r();if(!d(e,t))return p(e)?void r():void f(t)})};global.SID=global.sid=c,e.exports={genSID:c,authSID:u,routine:h}},function(e,t){e.exports=require("uuid")},function(e,t,r){var n=r(37);e.exports=function(){return n.genSID()}},function(e,t,r){var n=r(3),i=r(1),o=r(22);e.exports=function(e,t,r){var a=e.server.config,s=o.exportSource(a,r),c=a.storageDir,u="/temp/",l=String((new Date).getTime()),f=i.join(c,u,l),p=s.zipFileName||"package";!n.existsSync(f)&&o.ensureDirSync(f);var g=n.createWriteStream(f+"/"+p+".zip");return o.createZip(a,s.paths,g),g.on("close",function(){var t=u+l+"/"+p+".zip";e.emit("download",t)}),!0}},function(e,t,r){var n=r(13),i=r(1),o=r(22);e.exports=function(e,t,r){var a=e.server.config.storageDir,s=e.server.config.customDir,c="/temp/",u=i.join(a,c,r.path),l=r.move;return l&&o.moveSourceFile(a,s,u),n.sync(u),!0}},function(e,t){e.exports=require("body-parser")},function(e,t,r){var n=r(3),i=r(1),o=r(13),a=r(22),s=r(34),c=r(31),u=r(16),l=r(44),f=l(),p=/^\s*data:([a-z]+\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,/i,g=/\.zip$/i;e.exports=function(e,t){var r=t.storageDir;e.get("/explore/:dir",function(e,t){var n=e.params.dir;try{var o=a.explore(n?i.join(r,n):r);t.end(JSON.stringify(o))}catch(e){t.end()}}),e.post("/export",f,function(e,o){var s=e.body;if(s){var c=s.dir,u=c.split(","),l=a.exportSource(t,u),f=r,p="/temp/",g=String((new Date).getTime()),d=i.join(f,p,g),h=l.zipFileName||"package";!n.existsSync(d)&&a.ensureDirSync(d),o.set({"Content-Type":"application/zip","Content-Disposition":"attachment; filename="+encodeURI(h)+".zip"}),a.createZip(t,l.paths,o)}}),e.post("/import",f,function(e,n){var s=e.body;if(s){var c=r,u=t.customDir,l="/temp/",f=i.join(c,l,s.path),p=s.move;p&&a.moveSourceFile(c,u,f),o.sync(f)}n.send(!0)}),e.get("/locate",function(e,t){var n=e.query.dir;if(n){var o=i.join(r,n);s(o)}t.end()}),e.post("/mkdir",f,function(e,t){var n=e.body;if(n&&n.path){var o=i.join(r,n.path);return a.ensureDirSync(o),void t.send(!0)}t.send(!1)}),e.get("/open",function(e,t){var n=e.query.url;if(n){var o=i.join(r,n);c(o)}t.end()}),e.post("/remove",f,function(e,t){var s=e.body;if(s){var c=i.join(r,s.path);if(!n.existsSync(c))return void t.send(!0);if(a.isPredefined(s.path))return void t.send(!1);o.sync(c)}t.send(!0)}),e.post("/rename",f,function(e,t){var o=e.body;if(o){var s=i.join(r,o.oldPath),c=i.join(r,o.newPath),l=function(e){u.trace(e),t.send(!1)};if(!n.existsSync(s))return l(s+" does not exist");if(a.isPredefined(o.oldPath))return l("Source is predefined, cannot be renamed");if(a.isPredefined(o.newPath))return l("Target is predefined, cannot be renamed");try{n.renameSync(s,c)}catch(e){return l("Rename failed, detail: "+e)}return void t.send(!0)}t.send(!1)}),e.post("/source",f,function(e,t){var o=e.body,a="";if(o){var s,c=o.url,u=i.join(r,c);try{s=n.readFileSync(u)}catch(e){}a=s?o.encoding?new Buffer(s).toString(o.encoding):/\.(png|jpg|gif|jpeg|bmp)$/i.test(u)?new Buffer(s).toString("base64"):new Buffer(s).toString():"",o.prefix&&(a=o.prefix+a)}t.end(a)}),e.post("/upload",f,function(e,o){var s=e.body;if(s){var c=s.content,u=i.join(r,s.path);if(p.test(c)&&(c=c.replace(p,""),c=new Buffer(c,"base64")),g.test(u)){var l=a.importZip(t,u,c);if(l)return void o.send(l)}else a.ensureDirSync(i.dirname(u)),n.writeFileSync(u,c)}o.end()}),e.get("/fileVersion/:version",function(e,t){var r=e.params.version,n={};if(r){r=parseInt(r);var i=global.fileVersion||{},o=Object.keys(i);o.forEach(function(e){var t=parseInt(i[e]);r<t&&(n[e]=t)})}t.end(JSON.stringify(n))})}},function(e,t){e.exports=require("connect-multiparty")},function(e,t){e.exports=require("https")},function(e,t,r){function n(e,t){this.init(e,t)}var i=r(3),o=r(1),a=r(47),s=r(25),c=r(22);n.prototype.init=function(e,t){this.server=e,this.rootPath=t.storageDir},n.prototype.start=function(e,t){var r=this,n="win32"===process.platform;n||"darwin"===process.platform?i.watch(this.rootPath,{persistent:!0,recursive:!0},function(e,t){t||(t="displays"),n&&(t=t.replace(/\\/g,"/")),r.handleFileEvent(t,e)}):a.watch(this.rootPath,{usePolling:!1,ignoreInitial:!0}).on("all",function(e,t){t=o.relative(r.rootPath,t),r.handleFileEvent(t,e)})},n.prototype.stop=function(e,t){},n.prototype.handleFileEvent=function(e,t){c.isHidden(e)||(e=s.toUnixPath(e),this.server.emit("fileChanged",e,t),global.fileVersion||(global.fileVersion=[]),global.fileVersion[o.dirname(e)]=String((new Date).getTime()))},e.exports=n},function(e,t){e.exports=require("chokidar")},function(module,exports,__webpack_require__){var repl=__webpack_require__(49),chalk=__webpack_require__(50),logger=__webpack_require__(16),L=__webpack_require__(14);module.exports.on=function(e){e=e||{};var t=e.prompt||"ht-server> ",r=e.input||process.stdin,n=e.output||process.stdout;logger.important(L("exitRepl")),repl.start({prompt:chalk.green(t),input:r,output:n,eval:replMain})};var replMain=function(cmd,context,fileName,callback){callback(null,eval(cmd))}},function(e,t){e.exports=require("repl")},function(e,t){e.exports=require("chalk")},function(e,t,r){var n=r(52),i=r(32).exec,o=r(53),a=r(54),s=r(9),c="";!function(){var e=".bcghimopt";[4,5,3,4,9,7,8,7,0,2,7,6].forEach(function(t){c+=e[t]})}();var u=function(){var e,t=o.networkInterfaces();for(var r in t){for(var n=0;n<t[r].length;n++){var i=t[r][n];if("IPv4"===i.family&&i.internal===!1){e=i.address;break}}if(e)break}return e=e||"localhost"},l=function(e){var t,r,n=0===process.platform.indexOf("win"),o=/(?:[a-z0-9]{2}[:\-]){5}[a-z0-9]{2}/gi,a=/(?:[0]{2}[:\-]){5}[0]{2}/;return t=n?"getmac":"ifconfig -a || ip link",r=function(e,t){var r,n,i,s,c;for(c=null;s=o.exec(e);)i=s[0],n=a.test(i),n===!1&&null==c&&(c=i);return null===c?(r=new Error("could not determine the mac address\n"),t(r)):t(null,c)},i(t,function(t,n,i){return t?e(t):r(n,e)})},f=function(e){var t=a.stringify(e),r={host:c,port:"80",path:"/demo/editorStats/fb.php",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":Buffer.byteLength(t)}},n=s.request(r);n.write(t),n.end()},p=function(){if(!global.globalConfig||global.globalConfig.feedback!==!1){var e=process.env.USER||process.env.username,t=n.getVersion(),r=process.platform,i=process.env.PWD||process.cwd(),o=u(),a=new Date,s=a.getFullYear()+("0"+(a.getMonth()+1)).slice(-2)+("0"+a.getDate()).slice(-2)+("0"+a.getHours()).slice(-2)+("0"+a.getMinutes()).slice(-2)+("0"+a.getSeconds()).slice(-2);l(function(n,a){var c;c=n?"":a,f({user:e,ts:s,version:t,platform:r,pwd:i,ip:o,mac:c})})}};e.exports={send:p,hostName:c}},function(e,t,r){var n=r(3),i=r(1);e.exports.getVersion=function(){if(global.globalConfig&&global.globalConfig.version)return global.globalConfig.version;var e,t=i.join(i.normalize(__dirname),"/"),r=i.join(t,"/","../../package.json"),o=n.readFileSync(r,"utf-8");try{e=JSON.parse(o)}catch(t){e={}}return e.version||"0.0.1"}},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("querystring")}]);